var protomaps=(()=>{var Rr=Object.create;var Le=Object.defineProperty;var Ir=Object.getOwnPropertyDescriptor;var Vr=Object.getOwnPropertyNames,St=Object.getOwnPropertySymbols,jr=Object.getPrototypeOf,kt=Object.prototype.hasOwnProperty,qr=Object.prototype.propertyIsEnumerable;var Mt=(t,e,r)=>e in t?Le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pt=(t,e)=>{for(var r in e||(e={}))kt.call(e,r)&&Mt(t,r,e[r]);if(St)for(var r of St(e))qr.call(e,r)&&Mt(t,r,e[r]);return t};var Ct=t=>Le(t,"__esModule",{value:!0});var W=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Nr=(t,e)=>{Ct(t);for(var r in e)Le(t,r,{get:e[r],enumerable:!0})},Wr=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Vr(e))!kt.call(t,i)&&i!=="default"&&Le(t,i,{get:()=>e[i],enumerable:!(r=Ir(e,i))||r.enumerable});return t},R=t=>Wr(Ct(Le(t!=null?Rr(jr(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Y=(t,e,r)=>new Promise((i,n)=>{var a=l=>{try{o(r.next(l))}catch(u){n(u)}},s=l=>{try{o(r.throw(l))}catch(u){n(u)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,s);o((r=r.apply(t,e)).next())});var $=W((ln,Tt)=>{"use strict";Tt.exports=le;function le(t,e){this.x=t,this.y=e}le.prototype={clone:function(){return new le(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),a=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};le.convert=function(t){return t instanceof le?t:Array.isArray(t)?new le(t[0],t[1]):t}});var tt=W((un,Dt)=>{"use strict";var $r=$();Dt.exports=ue;function ue(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(Zr,this,e)}function Zr(t,e,r){t==1?e.id=r.readVarint():t==2?Ur(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function Ur(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}ue.types=["Unknown","Point","LineString","Polygon"];ue.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,a=0,s=[],o;t.pos<e;){if(i<=0){var l=t.readVarint();r=l&7,i=l>>3}if(i--,r===1||r===2)n+=t.readSVarint(),a+=t.readSVarint(),r===1&&(o&&s.push(o),o=[]),o.push(new $r(n,a));else if(r===7)o&&o.push(o[0].clone());else throw new Error("unknown command "+r)}return o&&s.push(o),s};ue.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,a=0,s=1/0,o=-1/0,l=1/0,u=-1/0;t.pos<e;){if(i<=0){var h=t.readVarint();r=h&7,i=h>>3}if(i--,r===1||r===2)n+=t.readSVarint(),a+=t.readSVarint(),n<s&&(s=n),n>o&&(o=n),a<l&&(l=a),a>u&&(u=a);else if(r!==7)throw new Error("unknown command "+r)}return[s,l,o,u]};ue.prototype.toGeoJSON=function(t,e,r){var i=this.extent*Math.pow(2,r),n=this.extent*t,a=this.extent*e,s=this.loadGeometry(),o=ue.types[this.type],l,u;function h(b){for(var x=0;x<b.length;x++){var w=b[x],f=180-(w.y+a)*360/i;b[x]=[(w.x+n)*360/i-180,360/Math.PI*Math.atan(Math.exp(f*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(l=0;l<s.length;l++)d[l]=s[l][0];s=d,h(s);break;case 2:for(l=0;l<s.length;l++)h(s[l]);break;case 3:for(s=Or(s),l=0;l<s.length;l++)for(u=0;u<s[l].length;u++)h(s[l][u]);break}s.length===1?s=s[0]:o="Multi"+o;var m={type:"Feature",geometry:{type:o,coordinates:s},properties:this.properties};return"id"in this&&(m.id=this.id),m};function Or(t){var e=t.length;if(e<=1)return[t];for(var r=[],i,n,a=0;a<e;a++){var s=Hr(t[a]);s!==0&&(n===void 0&&(n=s<0),n===s<0?(i&&r.push(i),i=[t[a]]):i.push(t[a]))}return i&&r.push(i),r}function Hr(t){for(var e=0,r=0,i=t.length,n=i-1,a,s;r<i;n=r++)a=t[r],s=t[n],e+=(s.x-a.x)*(a.y+s.y);return e}});var rt=W((hn,Xt)=>{"use strict";var Jr=tt();Xt.exports=Bt;function Bt(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Gr,this,e),this.length=this._features.length}function Gr(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(Qr(r))}function Qr(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}Bt.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Jr(this._pbf,e,this.extent,this._keys,this._values)}});var Yt=W((fn,At)=>{"use strict";var Kr=rt();At.exports=ei;function ei(t,e){this.layers=t.readFields(ti,{},e)}function ti(t,e,r){if(t===3){var i=new Kr(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}});var Et=W((dn,je)=>{je.exports.VectorTile=Yt();je.exports.VectorTileFeature=tt();je.exports.VectorTileLayer=rt()});var Rt=W(it=>{it.read=function(t,e,r,i,n){var a,s,o=n*8-i-1,l=(1<<o)-1,u=l>>1,h=-7,d=r?n-1:0,m=r?-1:1,b=t[e+d];for(d+=m,a=b&(1<<-h)-1,b>>=-h,h+=o;h>0;a=a*256+t[e+d],d+=m,h-=8);for(s=a&(1<<-h)-1,a>>=-h,h+=i;h>0;s=s*256+t[e+d],d+=m,h-=8);if(a===0)a=1-u;else{if(a===l)return s?NaN:(b?-1:1)*(1/0);s=s+Math.pow(2,i),a=a-u}return(b?-1:1)*s*Math.pow(2,a-i)};it.write=function(t,e,r,i,n,a){var s,o,l,u=a*8-n-1,h=(1<<u)-1,d=h>>1,m=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=i?0:a-1,x=i?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+d>=1?e+=m/l:e+=m*Math.pow(2,1-d),e*l>=2&&(s++,l/=2),s+d>=h?(o=0,s=h):s+d>=1?(o=(e*l-1)*Math.pow(2,n),s=s+d):(o=e*Math.pow(2,d-1)*Math.pow(2,n),s=0));n>=8;t[r+b]=o&255,b+=x,o/=256,n-=8);for(s=s<<n|o,u+=n;u>0;t[r+b]=s&255,b+=x,s/=256,u-=8);t[r+b-x]|=w*128}});var Wt=W((cn,Nt)=>{"use strict";Nt.exports=k;var qe=Rt();function k(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}k.Varint=0;k.Fixed64=1;k.Bytes=2;k.Fixed32=5;var nt=(1<<16)*(1<<16),It=1/nt,ri=12,Vt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");k.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,a=this.pos;this.type=i&7,t(n,e,this),this.pos===a&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ne(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=qt(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ne(this.buf,this.pos)+Ne(this.buf,this.pos+4)*nt;return this.pos+=8,t},readSFixed64:function(){var t=Ne(this.buf,this.pos)+qt(this.buf,this.pos+4)*nt;return this.pos+=8,t},readFloat:function(){var t=qe.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=qe.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,r,i;return i=e[this.pos++],r=i&127,i<128||(i=e[this.pos++],r|=(i&127)<<7,i<128)||(i=e[this.pos++],r|=(i&127)<<14,i<128)||(i=e[this.pos++],r|=(i&127)<<21,i<128)?r:(i=e[this.pos],r|=(i&15)<<28,ii(r,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=ri&&Vt?xi(this.buf,e,t):bi(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==k.Bytes)return t.push(this.readVarint(e));var r=O(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==k.Bytes)return t.push(this.readSVarint());var e=O(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==k.Bytes)return t.push(this.readBoolean());var e=O(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==k.Bytes)return t.push(this.readFloat());var e=O(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==k.Bytes)return t.push(this.readDouble());var e=O(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==k.Bytes)return t.push(this.readFixed32());var e=O(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==k.Bytes)return t.push(this.readSFixed32());var e=O(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==k.Bytes)return t.push(this.readFixed64());var e=O(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==k.Bytes)return t.push(this.readSFixed64());var e=O(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===k.Varint)for(;this.buf[this.pos++]>127;);else if(e===k.Bytes)this.pos=this.readVarint()+this.pos;else if(e===k.Fixed32)this.pos+=4;else if(e===k.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),fe(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),fe(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),fe(this.buf,t&-1,this.pos),fe(this.buf,Math.floor(t*It),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),fe(this.buf,t&-1,this.pos),fe(this.buf,Math.floor(t*It),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){ni(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=yi(this.buf,t,this.pos);var r=this.pos-e;r>=128&&jt(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),qe.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),qe.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&jt(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,k.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,oi,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,li,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,fi,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,ui,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,hi,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,di,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,mi,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,ci,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,pi,e)},writeBytesField:function(t,e){this.writeTag(t,k.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,k.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,k.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,k.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,k.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,k.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,k.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,k.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,k.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,k.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function ii(t,e,r){var i=r.buf,n,a;if(a=i[r.pos++],n=(a&112)>>4,a<128||(a=i[r.pos++],n|=(a&127)<<3,a<128)||(a=i[r.pos++],n|=(a&127)<<10,a<128)||(a=i[r.pos++],n|=(a&127)<<17,a<128)||(a=i[r.pos++],n|=(a&127)<<24,a<128)||(a=i[r.pos++],n|=(a&1)<<31,a<128))return he(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function O(t){return t.type===k.Bytes?t.readVarint()+t.pos:t.pos+1}function he(t,e,r){return r?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function ni(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(r=~(-t%4294967296),i=~(-t/4294967296),r^4294967295?r=r+1|0:(r=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),ai(r,i,e),si(i,e)}function ai(t,e,r){r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos]=t&127}function si(t,e){var r=(t&7)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127)))))}function jt(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function oi(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function li(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function ui(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function hi(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function fi(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function di(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function mi(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function ci(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function pi(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Ne(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function fe(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function qt(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function bi(t,e,r){for(var i="",n=e;n<r;){var a=t[n],s=null,o=a>239?4:a>223?3:a>191?2:1;if(n+o>r)break;var l,u,h;o===1?a<128&&(s=a):o===2?(l=t[n+1],(l&192)==128&&(s=(a&31)<<6|l&63,s<=127&&(s=null))):o===3?(l=t[n+1],u=t[n+2],(l&192)==128&&(u&192)==128&&(s=(a&15)<<12|(l&63)<<6|u&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):o===4&&(l=t[n+1],u=t[n+2],h=t[n+3],(l&192)==128&&(u&192)==128&&(h&192)==128&&(s=(a&15)<<18|(l&63)<<12|(u&63)<<6|h&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,o=1):s>65535&&(s-=65536,i+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),i+=String.fromCharCode(s),n+=o}return i}function xi(t,e,r){return Vt.decode(t.subarray(e,r))}function yi(t,e,r){for(var i=0,n,a;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(a)if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,a=n;continue}else n=a-55296<<10|n-56320|65536,a=null;else{n>56319||i+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):a=n;continue}else a&&(t[r++]=239,t[r++]=191,t[r++]=189,a=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=n&63|128)}return r}});var Ot=W(()=>{});var Ht=W((at,st)=>{(function(t,e){typeof at=="object"&&typeof st!="undefined"?st.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self,t.TinyQueue=e())})(at,function(){"use strict";var t=function(i,n){if(i===void 0&&(i=[]),n===void 0&&(n=e),this.data=i,this.length=this.data.length,this.compare=n,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};t.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var i=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),i}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(i){for(var n=this,a=n.data,s=n.compare,o=a[i];i>0;){var l=i-1>>1,u=a[l];if(s(o,u)>=0)break;a[i]=u,i=l}a[i]=o},t.prototype._down=function(i){for(var n=this,a=n.data,s=n.compare,o=this.length>>1,l=a[i];i<o;){var u=(i<<1)+1,h=a[u],d=u+1;if(d<this.length&&s(a[d],h)<0&&(u=d,h=a[d]),s(h,l)>=0)break;a[i]=h,i=u}a[i]=l};function e(r,i){return r<i?-1:r>i?1:0}return t})});var Gt=W((yn,ot)=>{"use strict";var We=Ht();We.default&&(We=We.default);ot.exports=Jt;ot.exports.default=Jt;function Jt(t,e,r){e=e||1;for(var i,n,a,s,o=0;o<t[0].length;o++){var l=t[0][o];(!o||l[0]<i)&&(i=l[0]),(!o||l[1]<n)&&(n=l[1]),(!o||l[0]>a)&&(a=l[0]),(!o||l[1]>s)&&(s=l[1])}var u=a-i,h=s-n,d=Math.min(u,h),m=d/2;if(d===0){var b=[i,n];return b.distance=0,b}for(var x=new We(void 0,Fi),w=i;w<a;w+=d)for(var f=n;f<s;f+=d)x.push(new G(w+m,f+m,m,t));var c=Li(t),p=new G(i+u/2,n+h/2,0,t);p.d>c.d&&(c=p);for(var v=x.length;x.length;){var y=x.pop();y.d>c.d&&(c=y,r&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,v)),!(y.max-c.d<=e)&&(m=y.h/2,x.push(new G(y.x-m,y.y-m,m,t)),x.push(new G(y.x+m,y.y-m,m,t)),x.push(new G(y.x-m,y.y+m,m,t)),x.push(new G(y.x+m,y.y+m,m,t)),v+=4)}r&&(console.log("num probes: "+v),console.log("best distance: "+c.d));var g=[c.x,c.y];return g.distance=c.d,g}function Fi(t,e){return e.max-t.max}function G(t,e,r,i){this.x=t,this.y=e,this.h=r,this.d=zi(t,e,i),this.max=this.d+this.h*Math.SQRT2}function zi(t,e,r){for(var i=!1,n=1/0,a=0;a<r.length;a++)for(var s=r[a],o=0,l=s.length,u=l-1;o<l;u=o++){var h=s[o],d=s[u];h[1]>e!=d[1]>e&&t<(d[0]-h[0])*(e-h[1])/(d[1]-h[1])+h[0]&&(i=!i),n=Math.min(n,Si(t,e,h,d))}return n===0?0:(i?1:-1)*Math.sqrt(n)}function Li(t){for(var e=0,r=0,i=0,n=t[0],a=0,s=n.length,o=s-1;a<s;o=a++){var l=n[a],u=n[o],h=l[0]*u[1]-u[0]*l[1];r+=(l[0]+u[0])*h,i+=(l[1]+u[1])*h,e+=h*3}return e===0?new G(n[0][0],n[0][1],0,t):new G(r/e,i/e,0,t)}function Si(t,e,r,i){var n=r[0],a=r[1],s=i[0]-n,o=i[1]-a;if(s!==0||o!==0){var l=((t-n)*s+(e-a)*o)/(s*s+o*o);l>1?(n=i[0],a=i[1]):l>0&&(n+=s*l,a+=o*l)}return s=t-n,o=e-a,s*s+o*o}});var Fr=W((bt,xt)=>{(function(t,e){typeof bt=="object"&&typeof xt!="undefined"?xt.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(bt,function(){"use strict";function t(f,c,p,v,y){(function g(_,F,z,S,B){for(;S>z;){if(S-z>600){var P=S-z+1,X=F-z+1,Fe=Math.log(P),ee=.5*Math.exp(2*Fe/3),se=.5*Math.sqrt(Fe*ee*(P-ee)/P)*(X-P/2<0?-1:1),oe=Math.max(z,Math.floor(F-X*ee/P+se)),Er=Math.min(S,Math.floor(F+(P-X)*ee/P+se));g(_,F,oe,Er,B)}var Ve=_[F],ze=z,N=S;for(e(_,z,F),B(_[S],Ve)>0&&e(_,z,S);ze<N;){for(e(_,ze,N),ze++,N--;B(_[ze],Ve)<0;)ze++;for(;B(_[N],Ve)>0;)N--}B(_[z],Ve)===0?e(_,z,N):e(_,++N,S),N<=F&&(z=N+1),F<=N&&(S=N-1)}})(f,c,p||0,v||f.length-1,y||r)}function e(f,c,p){var v=f[c];f[c]=f[p],f[p]=v}function r(f,c){return f<c?-1:f>c?1:0}var i=function(f){f===void 0&&(f=9),this._maxEntries=Math.max(4,f),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(f,c,p){if(!p)return c.indexOf(f);for(var v=0;v<c.length;v++)if(p(f,c[v]))return v;return-1}function a(f,c){s(f,0,f.children.length,c,f)}function s(f,c,p,v,y){y||(y=x(null)),y.minX=1/0,y.minY=1/0,y.maxX=-1/0,y.maxY=-1/0;for(var g=c;g<p;g++){var _=f.children[g];o(y,f.leaf?v(_):_)}return y}function o(f,c){return f.minX=Math.min(f.minX,c.minX),f.minY=Math.min(f.minY,c.minY),f.maxX=Math.max(f.maxX,c.maxX),f.maxY=Math.max(f.maxY,c.maxY),f}function l(f,c){return f.minX-c.minX}function u(f,c){return f.minY-c.minY}function h(f){return(f.maxX-f.minX)*(f.maxY-f.minY)}function d(f){return f.maxX-f.minX+(f.maxY-f.minY)}function m(f,c){return f.minX<=c.minX&&f.minY<=c.minY&&c.maxX<=f.maxX&&c.maxY<=f.maxY}function b(f,c){return c.minX<=f.maxX&&c.minY<=f.maxY&&c.maxX>=f.minX&&c.maxY>=f.minY}function x(f){return{children:f,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function w(f,c,p,v,y){for(var g=[c,p];g.length;)if(!((p=g.pop())-(c=g.pop())<=v)){var _=c+Math.ceil((p-c)/v/2)*v;t(f,_,c,p,y),g.push(c,_,_,p)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(f){var c=this.data,p=[];if(!b(f,c))return p;for(var v=this.toBBox,y=[];c;){for(var g=0;g<c.children.length;g++){var _=c.children[g],F=c.leaf?v(_):_;b(f,F)&&(c.leaf?p.push(_):m(f,F)?this._all(_,p):y.push(_))}c=y.pop()}return p},i.prototype.collides=function(f){var c=this.data;if(!b(f,c))return!1;for(var p=[];c;){for(var v=0;v<c.children.length;v++){var y=c.children[v],g=c.leaf?this.toBBox(y):y;if(b(f,g)){if(c.leaf||m(f,g))return!0;p.push(y)}}c=p.pop()}return!1},i.prototype.load=function(f){if(!f||!f.length)return this;if(f.length<this._minEntries){for(var c=0;c<f.length;c++)this.insert(f[c]);return this}var p=this._build(f.slice(),0,f.length-1,0);if(this.data.children.length)if(this.data.height===p.height)this._splitRoot(this.data,p);else{if(this.data.height<p.height){var v=this.data;this.data=p,p=v}this._insert(p,this.data.height-p.height-1,!0)}else this.data=p;return this},i.prototype.insert=function(f){return f&&this._insert(f,this.data.height-1),this},i.prototype.clear=function(){return this.data=x([]),this},i.prototype.remove=function(f,c){if(!f)return this;for(var p,v,y,g=this.data,_=this.toBBox(f),F=[],z=[];g||F.length;){if(g||(g=F.pop(),v=F[F.length-1],p=z.pop(),y=!0),g.leaf){var S=n(f,g.children,c);if(S!==-1)return g.children.splice(S,1),F.push(g),this._condense(F),this}y||g.leaf||!m(g,_)?v?(p++,g=v.children[p],y=!1):g=null:(F.push(g),z.push(p),p=0,v=g,g=g.children[0])}return this},i.prototype.toBBox=function(f){return f},i.prototype.compareMinX=function(f,c){return f.minX-c.minX},i.prototype.compareMinY=function(f,c){return f.minY-c.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(f){return this.data=f,this},i.prototype._all=function(f,c){for(var p=[];f;)f.leaf?c.push.apply(c,f.children):p.push.apply(p,f.children),f=p.pop();return c},i.prototype._build=function(f,c,p,v){var y,g=p-c+1,_=this._maxEntries;if(g<=_)return a(y=x(f.slice(c,p+1)),this.toBBox),y;v||(v=Math.ceil(Math.log(g)/Math.log(_)),_=Math.ceil(g/Math.pow(_,v-1))),(y=x([])).leaf=!1,y.height=v;var F=Math.ceil(g/_),z=F*Math.ceil(Math.sqrt(_));w(f,c,p,z,this.compareMinX);for(var S=c;S<=p;S+=z){var B=Math.min(S+z-1,p);w(f,S,B,F,this.compareMinY);for(var P=S;P<=B;P+=F){var X=Math.min(P+F-1,B);y.children.push(this._build(f,P,X,v-1))}}return a(y,this.toBBox),y},i.prototype._chooseSubtree=function(f,c,p,v){for(;v.push(c),!c.leaf&&v.length-1!==p;){for(var y=1/0,g=1/0,_=void 0,F=0;F<c.children.length;F++){var z=c.children[F],S=h(z),B=(P=f,X=z,(Math.max(X.maxX,P.maxX)-Math.min(X.minX,P.minX))*(Math.max(X.maxY,P.maxY)-Math.min(X.minY,P.minY))-S);B<g?(g=B,y=S<y?S:y,_=z):B===g&&S<y&&(y=S,_=z)}c=_||c.children[0]}var P,X;return c},i.prototype._insert=function(f,c,p){var v=p?f:this.toBBox(f),y=[],g=this._chooseSubtree(v,this.data,c,y);for(g.children.push(f),o(g,v);c>=0&&y[c].children.length>this._maxEntries;)this._split(y,c),c--;this._adjustParentBBoxes(v,y,c)},i.prototype._split=function(f,c){var p=f[c],v=p.children.length,y=this._minEntries;this._chooseSplitAxis(p,y,v);var g=this._chooseSplitIndex(p,y,v),_=x(p.children.splice(g,p.children.length-g));_.height=p.height,_.leaf=p.leaf,a(p,this.toBBox),a(_,this.toBBox),c?f[c-1].children.push(_):this._splitRoot(p,_)},i.prototype._splitRoot=function(f,c){this.data=x([f,c]),this.data.height=f.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(f,c,p){for(var v,y,g,_,F,z,S,B=1/0,P=1/0,X=c;X<=p-c;X++){var Fe=s(f,0,X,this.toBBox),ee=s(f,X,p,this.toBBox),se=(y=Fe,g=ee,_=void 0,F=void 0,z=void 0,S=void 0,_=Math.max(y.minX,g.minX),F=Math.max(y.minY,g.minY),z=Math.min(y.maxX,g.maxX),S=Math.min(y.maxY,g.maxY),Math.max(0,z-_)*Math.max(0,S-F)),oe=h(Fe)+h(ee);se<B?(B=se,v=X,P=oe<P?oe:P):se===B&&oe<P&&(P=oe,v=X)}return v||p-c},i.prototype._chooseSplitAxis=function(f,c,p){var v=f.leaf?this.compareMinX:l,y=f.leaf?this.compareMinY:u;this._allDistMargin(f,c,p,v)<this._allDistMargin(f,c,p,y)&&f.children.sort(v)},i.prototype._allDistMargin=function(f,c,p,v){f.children.sort(v);for(var y=this.toBBox,g=s(f,0,c,y),_=s(f,p-c,p,y),F=d(g)+d(_),z=c;z<p-c;z++){var S=f.children[z];o(g,f.leaf?y(S):S),F+=d(g)}for(var B=p-c-1;B>=c;B--){var P=f.children[B];o(_,f.leaf?y(P):P),F+=d(_)}return F},i.prototype._adjustParentBBoxes=function(f,c,p){for(var v=p;v>=0;v--)o(c[v],f)},i.prototype._condense=function(f){for(var c=f.length-1,p=void 0;c>=0;c--)f[c].children.length===0?c>0?(p=f[c-1].children).splice(p.indexOf(f[c]),1):this.clear():a(f[c],this.toBBox)},i})});var sn={};Nr(sn,{CenteredSymbolizer:()=>ht,CenteredTextSymbolizer:()=>Z,CircleSymbolizer:()=>J,DataDrivenOffsetSymbolizer:()=>Lt,DataDrivenOffsetTextSymbolizer:()=>Yr,FlexSymbolizer:()=>Ce,Font:()=>rn,GeomType:()=>j,GroupSymbolizer:()=>Te,GroupedLineSymbolizer:()=>sr,GroupedPolygonSymbolizer:()=>rr,IconSymbolizer:()=>or,Index:()=>yt,Justify:()=>E,Labeler:()=>Xe,Labelers:()=>Ae,LineLabelPlacement:()=>de,LineLabelSymbolizer:()=>me,LineSymbolizer:()=>A,MAX_VERTICES_PER_DRAW_CALL:()=>H,OffsetSymbolizer:()=>ft,OffsetTextSymbolizer:()=>re,PMTiles:()=>ke,Padding:()=>ur,PmtilesSource:()=>K,PolygonLabelSymbolizer:()=>ce,PolygonSymbolizer:()=>D,ShieldSymbolizer:()=>Ze,Sprites:()=>nn,Static:()=>Br,TextPlacements:()=>M,TextSymbolizer:()=>te,TileCache:()=>be,View:()=>xe,ZxySource:()=>pe,arr:()=>Ci,covering:()=>Sr,createPattern:()=>Pi,cubicBezier:()=>Bi,dark:()=>ge,exp:()=>V,filterFn:()=>Ie,getFont:()=>Ft,getZoom:()=>wt,isCCW:()=>Oe,isInRing:()=>mt,json_style:()=>an,labelRules:()=>_e,leafletLayer:()=>Ki,light:()=>ye,linear:()=>Di,numberFn:()=>et,numberOrFn:()=>vt,paintRules:()=>ve,painter:()=>Be,pointInPolygon:()=>gr,pointMinDistToLines:()=>vr,pointMinDistToPoints:()=>wr,step:()=>Ti,toIndex:()=>Q,transformGeom:()=>ne,widthFn:()=>_t,wrap:()=>De,xray:()=>pt});var ae=R($());var He=R($()),cr=R(Et()),pr=R(Wt());var gi=Object.defineProperty,wi=(t,e,r)=>e in t?gi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Se=(t,e,r)=>(wi(t,typeof e!="symbol"?e+"":e,r),r),$t=(t,e)=>t*Math.pow(2,e),Zt=(t,e)=>$t(t.getUint16(e+1,!0),8)+t.getUint8(e,!0),vi=(t,e)=>$t(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),_i=t=>{var e=t.getUint16(0,!0);if(e!==19792)throw new Error('File header does not begin with "PM"');var r=t.getUint16(2,!0),i=t.getUint32(4,!0),n=t.getUint16(8,!0);return{version:r,json_size:i,root_entries:n}},Ut=t=>{let e=new Map;for(var r=0;r<t.byteLength;r+=17){var i=t.getUint8(r,!0),n=i&127,a=i>>7,s=Zt(t,r+1),o=Zt(t,r+4),l=vi(t,r+7),u=t.getUint32(r+13,!0);e.set(n+"_"+s+"_"+o,[l,u,a])}return e},ke=class{constructor(e){Se(this,"metadata",n=>new Promise((a,s)=>{this.root.then(o=>{a(o.metadata)})})),Se(this,"getLeaf",(n,a)=>new Promise((s,o)=>{this.leaves.has(n)?(this.leaves.get(n)[0]++,s(this.leaves.get(n)[1])):this.outstanding_requests.has(n)?this.outstanding_requests.get(n).push(s):(this.outstanding_requests.set(n,[]),fetch(this.url,{headers:{Range:"bytes="+n+"-"+(n+a-1)}}).then(l=>l.arrayBuffer()).then(l=>{var u=Ut(new DataView(l),a/17);if(this.leaves.size>32){var h=1/0,d=void 0;this.leaves.forEach((m,b)=>{m[0]<h&&(h=m[0],d=b)}),this.leaves.delete(d)}this.leaves.set(n,[this.step++,u]),s(u),this.outstanding_requests.get(n).forEach(m=>m(u)),this.outstanding_requests.delete(n)}))})),Se(this,"getZxy",(n,a,s)=>{var o=n+"_"+a+"_"+s;return this.root.then(l=>{if(l.dir.has(o)&&l.dir.get(o)[2]==0)return l.dir.get(o);if(n>=7){var u=n-7,h=[7,Math.trunc(a/(1<<u)),Math.trunc(s/(1<<u))],d=h[0]+"_"+h[1]+"_"+h[2];if(l.dir.has(d)&&l.dir.get(d)[2]==1){let m=l.dir.get(d);return this.getLeaf(m[0],m[1]).then(b=>b.has(o)?b.get(o):null)}}return null})}),Se(this,"transformRequest",(n,a,s,o)=>{if(n.endsWith(".pmtiles")&&o){var l=s.tileID.canonical,u=l.z+"_"+l.x+"_"+l.y;this.getZxy(l.z,l.x,l.y).then(h=>{h&&o({url:this.url,headers:{Range:"bytes="+h[0]+"-"+(h[0]+h[1]-1)}})})}return{url:n}}),Se(this,"leafletLayer",n=>{let a=this;var s=L.GridLayer.extend({createTile:function(o,l){var u=document.createElement("img"),h;return a.getZxy(o.z,o.x,o.y).then(d=>{d!==null&&fetch(a.url,{headers:{Range:"bytes="+d[0]+"-"+(d[0]+d[1]-1)}}).then(m=>m.arrayBuffer()).then(m=>{var b=new Blob([m],{type:"image/png"}),x=window.URL.createObjectURL(b);u.src=x,l(h,u)})}),u},_removeTile:function(o){var l=this._tiles[o];!l||(l.el.width=0,l.el.height=0,l.el.deleted=!0,L.DomUtil.remove(l.el),delete this._tiles[o],this.fire("tileunload",{tile:l.el,coords:this._keyToTileCoords(o)}))}});return new s(n)}),this.url=e;let r=new AbortController,i=r.signal;this.root=fetch(this.url,{signal:i,headers:{Range:"bytes=0-511999"}}).then(n=>(n.headers.get("Content-Length")!=512e3&&(console.error("Content-Length mismatch indicates byte serving not supported; aborting."),r.abort()),n.arrayBuffer())).then(n=>{let a=_i(new DataView(n,0,10));var s=new TextDecoder("utf-8");return{metadata:JSON.parse(s.decode(new DataView(n,10,a.json_size))),dir:Ut(new DataView(n,10+a.json_size,17*a.root_entries))}}),this.step=0,this.leaves=new Map,this.outstanding_requests=new Map}};var I=R($()),er=R(Ot());var tr=R(Gt());var T=class{constructor(e,r=""){this.str=e||r,this.per_feature=typeof this.str=="function"&&this.str.length==2}get(e,r){return typeof this.str=="function"?this.str(e,r):this.str}},C=class{constructor(e,r=1){this.value=e||r,this.per_feature=typeof this.value=="function"&&this.value.length==2}get(e,r){return typeof this.value=="function"?this.value(e,r):this.value}},Me=class{constructor(e={}){this.label_props=e.label_props||["name"],this.textTransform=e.textTransform}get(e,r){var i,n;typeof this.label_props=="function"?n=this.label_props(e,r):n=this.label_props;for(let s of n)if(r.props.hasOwnProperty(s)){i=r.props[s];break}let a;return typeof this.textTransform=="function"?a=this.textTransform(e,r):a=this.textTransform,i&&a==="uppercase"?i=i.toUpperCase():i&&a==="lowercase"?i=i.toLowerCase():i&&a==="capitalize"&&(i=i.toLowerCase().split(" ").map(l=>l[0].toUpperCase()+l.slice(1)).join(" ")),i}},Pe=class{constructor(e){e.font?this.font=e.font:(this.family=e.fontFamily||"sans-serif",this.size=e.fontSize||12,this.weight=e.fontWeight,this.style=e.fontStyle)}get(e,r){if(this.font)return typeof this.font=="function"?this.font(e,r):this.font;var i="";this.style&&(typeof this.style=="function"?i=this.style(e,r)+" ":i=this.style+" ");var n="";this.weight&&(typeof this.weight=="function"?n=this.weight(e,r)+" ":n=this.weight+" ");var a;typeof this.size=="function"?a=this.size(e,r):a=this.size;var s;return typeof this.family=="function"?s=this.family(e,r):s=this.family,`${i}${n}${a}px ${s}`}},$e=class{constructor(e,r=[]){this.value=e||r,this.per_feature=typeof this.value=="function"&&this.value.length==2}get(e,r){return typeof this.value=="function"?this.value(e,r):this.value}};function lt(t,e){if(t.length<=e)return[t];let r=e-1,i=t.lastIndexOf(" ",r),n=t.indexOf(" ",r);if(i==-1&&n==-1)return[t];let a,s;return n==-1||i>=0&&r-i<n-r?(a=t.substring(0,i),s=t.substring(i+1,t.length)):(a=t.substring(0,n),s=t.substring(n+1,t.length)),[a,...lt(s,e)]}var ki="\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DB5\u4E00-\u9FEA\uF900-\uFA6D\uFA70-\uFAD9\u2000",wn=new RegExp("^["+ki+"]+$");var ut=R($()),Mi=(t,e,r)=>{var i=[],n,a,s,o=0,l=0,u=0,h=0,d=0,m=0,b=0,x=0,w=0,f=0,c=0,p=0;if(t.length<2)return[];if(t.length===2)return u=Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),[{length:u,beginIndex:0,beginDistance:0,endIndex:2,endDistance:u}];for(h=Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),o=1,l=t.length-1;o<l;o++)n=t[o-1],a=t[o],s=t[o+1],m=a.x-n.x,b=a.y-n.y,x=s.x-a.x,w=s.y-a.y,d=Math.sqrt(x*x+w*w),u+=h,f=Math.acos((m*x+b*w)/(h*d)),(f>e||u-p>r)&&(i.push({length:u-p,beginDistance:p,beginIndex:c,endIndex:o+1,endDistance:u}),c=o,p=u),h=d;return o-c>0&&i.push({length:u-p+d,beginIndex:c,beginDistance:p,endIndex:o+1,endDistance:u+d}),i};function Qt(t,e,r,i){let n,a,s=0,o=[];var l=-1/0;for(let h of t){let d=Mi(h,Math.PI/45,e);for(let m of d)if(m.length>=e+i){let b=new ut.default(h[m.beginIndex].x,h[m.beginIndex].y),x=h[m.endIndex-1],w=new ut.default((x.x-b.x)/m.length,(x.y-b.y)/m.length);for(var u=i;u<m.length-e;u+=r)o.push({start:b.add(w.mult(u)),end:b.add(w.mult(u+e))})}}return o}function Kt(t,e,r,i){let n=e.x-t.x,a=e.y-t.y,s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=[];for(var l=0;l<r+i;l+=2*i){let u=l*1/s;o.push({x:t.x+u*n,y:t.y+u*a})}return o}var H=4e3,E;(function(i){i[i.Left=1]="Left",i[i.Center=2]="Center",i[i.Right=3]="Right"})(E||(E={}));var Pi=(t,e,r)=>{let i=document.createElement("canvas"),n=i.getContext("2d");return i.width=t,i.height=e,r(i,n),i},D=class{constructor(e){this.pattern=e.pattern,this.fill=new T(e.fill,"black"),this.opacity=new C(e.opacity,1),this.stroke=new T(e.stroke,"black"),this.width=new C(e.width,0),this.per_feature=this.fill.per_feature||this.opacity.per_feature||this.stroke.per_feature||this.width.per_feature||e.per_feature,this.do_stroke=!1}before(e,r){if(!this.per_feature){e.globalAlpha=this.opacity.get(r),e.fillStyle=this.fill.get(r),e.strokeStyle=this.stroke.get(r);let i=this.width.get(r);i>0&&(this.do_stroke=!0),e.lineWidth=i}this.pattern&&(e.fillStyle=e.createPattern(this.pattern,"repeat"))}draw(e,r,i,n){var a=!1;if(this.per_feature){e.globalAlpha=this.opacity.get(i,n),e.fillStyle=this.fill.get(i,n);var s=this.width.get(i,n);s&&(a=!0,e.strokeStyle=this.stroke.get(i,n),e.lineWidth=s)}let o=()=>{e.fill(),(a||this.do_stroke)&&e.stroke()};var l=0;e.beginPath();for(var u of r){l+u.length>H&&(o(),l=0,e.beginPath());for(var h=0;h<u.length-1;h++){let d=u[h];h==0?e.moveTo(d.x,d.y):e.lineTo(d.x,d.y)}l+=u.length}l>0&&o()}},rr=class{constructor(e){this.pattern=e.pattern,this.fill=new T(e.fill,"black"),this.opacity=new C(e.opacity,1),this.stroke=new T(e.stroke,"black"),this.width=new C(e.width,0),this.do_stroke=!1}before(e,r){e.globalAlpha=this.opacity.get(r),e.fillStyle=this.fill.get(r),e.strokeStyle=this.stroke.get(r);let i=this.width.get(r);i>0&&(this.do_stroke=!0),e.lineWidth=i,this.pattern&&(e.fillStyle=e.createPattern(this.pattern,"repeat"))}drawGrouped(e,r,i,n,a,s){let o=()=>{e.fill(),this.do_stroke&&e.stroke()},l=0;e.save(),e.beginPath();for(let u of i)n(u)&&s(u)&&a(u.geom).forEach(d=>{l+d.length>H&&(o(),e.beginPath(),l=0),e.moveTo(d[0].x,d[0].y);for(var m=1;m<d.length;m++){let b=d[m];e.lineTo(b.x,b.y)}l+=d.length});o(),e.restore()}};function Ci(t,e){return r=>{let i=r-t;return i>=0&&i<e.length?e[i]:0}}function ir(t,e){let r=0;for(;e[r+1][0]<t;)r++;return r}function nr(t,e,r){return t*(r-e)+e}function ar(t,e,r,i){let n=i[e+1][0]-i[e][0],a=t-i[e][0];return n===0?0:r===1?a/n:(Math.pow(r,a)-1)/(Math.pow(r,n)-1)}function V(t,e){return r=>{if(e.length<1)return 0;if(r<=e[0][0])return e[0][1];if(r>=e[e.length-1][0])return e[e.length-1][1];let i=ir(r,e),n=ar(r,i,t,e);return nr(n,e[i][1],e[i+1][1])}}function Ti(t,e){return r=>{if(e.length<1)return 0;let i=t;for(let n=0;n<e.length;n++)r>=e[n][0]&&(i=e[n][1]);return i}}function Di(t){return V(1,t)}function Bi(t,e,r,i,n){return a=>{if(n.length<1)return 0;let s=new er.default(t,e,r,i),o=ir(a,n),l=s.solve(ar(a,o,1,n));return nr(l,n[o][1],n[o+1][1])}}var A=class{constructor(e){this.color=new T(e.color,"black"),this.width=new C(e.width),this.opacity=new C(e.opacity),this.dash=e.dash?new $e(e.dash):null,this.dashColor=new T(e.dashColor,"black"),this.dashWidth=new C(e.dashWidth,1),this.lineCap=new T(e.lineCap,"butt"),this.lineJoin=new T(e.lineJoin,"miter"),this.skip=!1,this.per_feature=this.dash||this.color.per_feature||this.opacity.per_feature||this.width.per_feature||this.lineCap.per_feature||this.lineJoin.per_feature||e.per_feature}before(e,r){this.per_feature||(e.strokeStyle=this.color.get(r),e.lineWidth=this.width.get(r),e.globalAlpha=this.opacity.get(r),e.lineCap=this.lineCap.get(r),e.lineJoin=this.lineJoin.get(r))}draw(e,r,i,n){if(this.skip)return;let a=()=>{this.per_feature&&(e.globalAlpha=this.opacity.get(i,n),e.lineCap=this.lineCap.get(i,n),e.lineJoin=this.lineJoin.get(i,n)),this.dash?(e.lineWidth=this.dashWidth.get(i,n),e.strokeStyle=this.dashColor.get(i,n),e.setLineDash(this.dash.get(i,n))):this.per_feature&&(e.lineWidth=this.width.get(i,n),e.strokeStyle=this.color.get(i,n))};var s=0;e.save(),e.beginPath(),a();for(var o of r){s+o.length>H&&(e.stroke(),s=0,e.beginPath()),e.moveTo(o[0].x,o[0].y);for(var l=1;l<o.length;l++){let u=o[l];e.lineTo(u.x,u.y)}s+=o.length}s>0&&e.stroke(),e.restore()}},sr=class{constructor(e){this.color=new T(e.color,"black"),this.width=new C(e.width),this.opacity=new C(e.opacity),this.dash=e.dash?new $e(e.dash):null,this.dashColor=new T(e.dashColor,"black"),this.dashWidth=new C(e.dashWidth,1),this.lineCap=new T(e.lineCap,"butt"),this.lineJoin=new T(e.lineJoin,"miter"),this.skip=!1,this.per_feature=!1}before(e,r){e.strokeStyle=this.color.get(r),e.lineWidth=this.width.get(r),e.globalAlpha=this.opacity.get(r),e.lineCap=this.lineCap.get(r),e.lineJoin=this.lineJoin.get(r)}drawGrouped(e,r,i,n,a,s){if(this.skip)return;let o=u=>{this.dash&&(e.lineWidth=this.dashWidth.get(u),e.strokeStyle=this.dashColor.get(u),e.setLineDash(this.dash.get(u)))},l=0;e.save(),o(r),e.beginPath();for(let u of i)n(u)&&s(u)&&a(u.geom).forEach(d=>{l+d.length>H&&(e.stroke(),e.beginPath(),l=0),e.moveTo(d[0].x,d[0].y);for(var m=1;m<d.length;m++){let b=d[m];e.lineTo(b.x,b.y)}l+=d.length});e.stroke(),e.restore()}},or=class{constructor(e){this.sprites=e.sprites,this.name=e.name}place(e,r,i){let n=r[0],a=new I.default(r[0][0].x,r[0][0].y),s={minX:a.x-32,minY:a.y-32,maxX:a.x+32,maxY:a.y+32};return[{anchor:a,bboxes:[s],draw:l=>{l.globalAlpha=1;let u=this.sprites.get(this.name);l.drawImage(u.canvas,u.x,u.y,u.w,u.h,-8,-8,u.w,u.h)}}]}},J=class{constructor(e){this.radius=new C(e.radius,3),this.fill=new T(e.fill,"black"),this.stroke=new T(e.stroke,"white"),this.width=new C(e.width,0),this.opacity=new C(e.opacity)}draw(e,r,i,n){e.globalAlpha=this.opacity.get(i,n);let a=this.radius.get(i,n),s=this.width.get(i,n);s>0&&(e.fillStyle=this.stroke.get(i,n),e.beginPath(),e.arc(r[0][0].x,r[0][0].y,a+s,0,2*Math.PI),e.fill()),e.fillStyle=this.fill.get(i,n),e.beginPath(),e.arc(r[0][0].x,r[0][0].y,a,0,2*Math.PI),e.fill()}place(e,r,i){let n=r[0],a=new I.default(r[0][0].x,r[0][0].y),s=this.radius.get(e.zoom,i),o={minX:a.x-s,minY:a.y-s,maxX:a.x+s,maxY:a.y+s};return[{anchor:a,bboxes:[o],draw:u=>{this.draw(u,[[new I.default(0,0)]],e.zoom,i)}}]}},Ze=class{constructor(e){this.font=new Pe(e),this.text=new Me(e),this.fill=new T(e.fill,"black"),this.background=new T(e.background,"white"),this.padding=new C(e.padding,0)}place(e,r,i){let n=this.text.get(e.zoom,i);if(!n)return;let a=this.font.get(e.zoom,i);e.scratch.font=a;let s=e.scratch.measureText(n),o=s.width,l=s.actualBoundingBoxAscent,u=s.actualBoundingBoxDescent,h=r[0],d=new I.default(r[0][0].x,r[0][0].y),m=this.padding.get(e.zoom,i),b={minX:d.x-o/2-m,minY:d.y-l-m,maxX:d.x+o/2+m,maxY:d.y+u+m};return[{anchor:d,bboxes:[b],draw:w=>{w.globalAlpha=1,w.fillStyle=this.background.get(e.zoom,i),w.fillRect(-o/2-m,-l-m,o+2*m,l+u+2*m),w.fillStyle=this.fill.get(e.zoom,i),w.font=a,w.fillText(n,-o/2,0)}}]}},Ce=class{constructor(e,r){this.list=e}place(e,r,i){var n=this.list[0].place(e,r,i);if(!n)return;var a=n[0];let s=a.anchor,o=a.bboxes[0],l=o.maxY-o.minY,u=[{draw:a.draw,translate:{x:0,y:0}}],h=[[{x:r[0][0].x,y:r[0][0].y+l}]];for(let m=1;m<this.list.length;m++)n=this.list[m].place(e,h,i),n&&(a=n[0],o=lr(o,a.bboxes[0]),u.push({draw:a.draw,translate:{x:0,y:l}}));return[{anchor:s,bboxes:[o],draw:m=>{for(let b of u)m.save(),m.translate(b.translate.x,b.translate.y),b.draw(m),m.restore()}}]}},lr=(t,e)=>({minX:Math.min(t.minX,e.minX),minY:Math.min(t.minY,e.minY),maxX:Math.max(t.maxX,e.maxX),maxY:Math.max(t.maxY,e.maxY)}),Te=class{constructor(e){this.list=e}place(e,r,i){let n=this.list[0];if(!n)return;var a=n.place(e,r,i);if(!a)return;var s=a[0];let o=s.anchor,l=s.bboxes[0],u=[s.draw];for(let d=1;d<this.list.length;d++){if(a=this.list[d].place(e,r,i),!a)return;s=a[0],l=lr(l,s.bboxes[0]),u.push(s.draw)}return[{anchor:o,bboxes:[l],draw:d=>{u.forEach(m=>m(d))}}]}},ht=class{constructor(e){this.symbolizer=e}place(e,r,i){let n=r[0][0],a=this.symbolizer.place(e,[[new I.default(0,0)]],i);if(!a||a.length==0)return;let s=a[0],o=s.bboxes[0],l=o.maxX-o.minX,u=o.maxY-o.minY,h={minX:n.x-l/2,maxX:n.x+l/2,minY:n.y-u/2,maxY:n.y+u/2};return[{anchor:n,bboxes:[h],draw:m=>{m.translate(-l/2,u/2-o.maxY),s.draw(m,{justify:2})}}]}},ur=class{constructor(e,r){this.padding=new C(e,0),this.symbolizer=r}place(e,r,i){let n=this.symbolizer.place(e,r,i);if(!n||n.length==0)return;let a=this.padding.get(e.zoom,i);for(var s of n)for(var o of s.bboxes)o.minX-=a,o.minY-=a,o.maxX+=a,o.maxY+=a;return n}},te=class{constructor(e){this.font=new Pe(e),this.text=new Me(e),this.fill=new T(e.fill,"black"),this.stroke=new T(e.stroke,"black"),this.width=new C(e.width,0),this.lineHeight=new C(e.lineHeight,1),this.letterSpacing=new C(e.letterSpacing,0),this.maxLineCodeUnits=new C(e.maxLineChars,15),this.justify=e.justify}place(e,r,i){let n=this.text.get(e.zoom,i);if(!n)return;let a=this.font.get(e.zoom,i);e.scratch.font=a;let s=this.letterSpacing.get(e.zoom,i),o=lt(n,this.maxLineCodeUnits.get(e.zoom,i));var l,u=0;for(let p of o)p.length>u&&(u=p.length,l=p);let h=e.scratch.measureText(l),d=h.width+s*(u-1),m=h.actualBoundingBoxAscent,b=h.actualBoundingBoxDescent,x=(m+b)*this.lineHeight.get(e.zoom,i),w=new I.default(r[0][0].x,r[0][0].y),f={minX:w.x,minY:w.y-m,maxX:w.x+d,maxY:w.y+b+(o.length-1)*x};return[{anchor:w,bboxes:[f],draw:(p,v)=>{p.globalAlpha=1,p.font=a,p.fillStyle=this.fill.get(e.zoom,i);let y=this.width.get(e.zoom,i);var g=0;for(let S of o){var _=0;if(this.justify==2||v&&v.justify==2?_=(d-p.measureText(S).width)/2:(this.justify==3||v&&v.justify==3)&&(_=d-p.measureText(S).width),y)if(p.lineWidth=y*2,p.strokeStyle=this.stroke.get(e.zoom,i),s>0){var F=_;for(var z of S)p.strokeText(z,F,g),F+=p.measureText(z).width+s}else p.strokeText(S,_,g);if(s>0){var F=_;for(var z of S)p.fillText(z,F,g),F+=p.measureText(z).width+s}else p.fillText(S,_,g);g+=x}}}]}},Z=class{constructor(e){this.centered=new ht(new te(e))}place(e,r,i){return this.centered.place(e,r,i)}},ft=class{constructor(e,r){this.symbolizer=e,this.offset=new C(r.offset,0)}place(e,r,i){if(i.geomType!==j.Point)return;let n=r[0][0],a=this.symbolizer.place(e,[[new I.default(0,0)]],i);if(!a||a.length==0)return;let s=a[0],o=s.bboxes[0],l=this.offset.get(e.zoom,i),u=(x,w)=>({minX:x.x+w.x+o.minX,minY:x.y+w.y+o.minY,maxX:x.x+w.x+o.maxX,maxY:x.y+w.y+o.maxY});var h=new I.default(l,-l),d;let m=x=>{x.translate(h.x,h.y),s.draw(x,{justify:d})};var b=u(n,h);if(d=1,!e.index.bboxCollides(b,e.order))return[{anchor:n,bboxes:[b],draw:m}];if(h=new I.default(-l-o.maxX,l-o.minY),b=u(n,h),d=3,!e.index.bboxCollides(b,e.order))return[{anchor:n,bboxes:[b],draw:m}];if(h=new I.default(-l-o.maxX,-l),b=u(n,h),d=3,!e.index.bboxCollides(b,e.order))return[{anchor:n,bboxes:[b],draw:m}];if(h=new I.default(-l-o.maxX,l-o.minY),b=u(n,h),d=1,!e.index.bboxCollides(b,e.order))return[{anchor:n,bboxes:[b],draw:m}]}},re=class{constructor(e){this.symbolizer=new ft(new te(e),e)}place(e,r,i){return this.symbolizer.place(e,r,i)}},de;(function(i){i[i.Above=1]="Above",i[i.Center=2]="Center",i[i.Below=3]="Below"})(de||(de={}));var me=class{constructor(e){this.font=new Pe(e),this.text=new Me(e),this.fill=new T(e.fill,"black"),this.stroke=new T(e.stroke,"black"),this.width=new C(e.width,0),this.offset=new C(e.offset,0),this.position=e.position||1,this.maxLabelCodeUnits=new C(e.maxLabelChars,40),this.repeatDistance=new C(e.repeatDistance,250)}place(e,r,i){let n=this.text.get(e.zoom,i);if(!n||n.length>this.maxLabelCodeUnits.get(e.zoom,i))return;let a=20,s=i.bbox;if(s.maxY-s.minY<a&&s.maxX-s.minX<a)return;let o=this.font.get(e.zoom,i);e.scratch.font=o;let l=e.scratch.measureText(n),u=l.width,h=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent;var d=this.repeatDistance.get(e.zoom,i);e.overzoom>4&&(d*=1<<e.overzoom-4);let m=h*2,b=Qt(r,u,d,m);if(b.length==0)return;let x=[];for(let w of b){let f=w.end.x-w.start.x,c=w.end.y-w.start.y,v=Kt(w.start,w.end,u,m/2).map(g=>({minX:g.x-m/2,minY:g.y-m/2,maxX:g.x+m/2,maxY:g.y+m/2})),y=g=>{g.globalAlpha=1;let _=0;this.position===3?_=h:this.position===2&&(_=h/2);let F=Math.atan2(-c,f);g.translate(Math.cos(F-Math.PI/2)*_,-Math.sin(F-Math.PI/2)*_),g.rotate(-F),f<0&&(g.scale(-1,-1),g.translate(-u,2*_)),g.translate(0,-this.offset.get(e.zoom,i)),g.font=o;let z=this.width.get(e.zoom,i);z&&(g.lineWidth=z,g.strokeStyle=this.stroke.get(e.zoom,i),g.strokeText(n,0,0)),g.fillStyle=this.fill.get(e.zoom,i),g.fillText(n,0,0)};x.push({anchor:w.start,bboxes:v,draw:y,deduplicationKey:n,deduplicationDistance:d})}return x}},ce=class{constructor(e){this.symbolizer=new te(e)}place(e,r,i){let n=i.bbox;if((n.maxY-n.minY)*(n.maxX-n.minX)<2e4)return;let s=this.symbolizer.place(e,[[new I.default(0,0)]],i);if(!s||s.length==0)return;let o=s[0],l=o.bboxes[0],u=r[0],h=(0,tr.default)([u.map(x=>[x.x,x.y])]),d=new I.default(h[0],h[1]),m={minX:d.x-(l.maxX-l.minX)/2,minY:d.y-(l.maxY-l.minY)/2,maxX:d.x+(l.maxX-l.minX)/2,maxY:d.y+(l.maxY-l.minY)/2};return[{anchor:d,bboxes:[m],draw:x=>{x.translate(o.anchor.x-(l.maxX-l.minX)/2,o.anchor.y),o.draw(x)}}]}};var Ue=(t,e)=>t[1].area-e[1].area;function Xi(){var t={},e=[];t.push=function(){for(var n=0,a=arguments.length;n<a;++n){var s=arguments[n];r(s.index=e.push(s)-1)}return e.length},t.pop=function(){var n=e[0],a=e.pop();return e.length&&(e[a.index=0]=a,i(0)),n},t.remove=function(n){var a=n.index,s=e.pop();return a!==e.length&&(e[s.index=a]=s,(Ue(s,n)<0?r:i)(a)),a};function r(n){for(var a=e[n];n>0;){var s=(n+1>>1)-1,o=e[s];if(Ue(a,o)>=0)break;e[o.index=n]=o,e[a.index=n=s]=a}}function i(n){for(var a=e[n];;){var s=(n+1)*2,o=s-1,l=n,u=e[l];if(o<e.length&&Ue(e[o],u)<0&&(u=e[l=o]),s<e.length&&Ue(e[s],u)<0&&(u=e[l=s]),l===n)break;e[u.index=n]=u,e[a.index=n=l]=a}}return t}var hr=t=>Math.abs((t[0].x-t[2].x)*(t[1].y-t[0].y)-(t[0].x-t[1].x)*(t[2].y-t[0].y)),fr=(t,e)=>{let r=[];for(let s of t){let o=Ai(s,e);r=r.concat(o)}if(e>=r.length)return t;r.sort(function(s,o){return o-s});let i=[],n=r[e],a=0;for(let s of t){let o=s.filter(function(l){return l.area>n});o.length>=3&&(i.push(o),a+=o.length)}return i},Ai=(t,e)=>{var r=0;let i=Xi();var n;let a=[];for(var s=1,o=t.length-1;s<o;++s)n=t.slice(s-1,s+2),(n[1].area=hr(n))&&(a.push(n),i.push(n));for(var s=0,o=a.length;s<o;++s)n=a[s],n.previous=a[s-1],n.next=a[s+1];for(;n=i.pop();)n[1].area<r?n[1].area=r:r=n[1].area,n.previous?(n.previous.next=n.next,n.previous[2]=n[2],l(n.previous)):n[0].area=n[1].area,n.next?(n.next.previous=n.previous,n.next[0]=n[0],l(n.next)):n[2].area=n[1].area;function l(h){i.remove(h),h[1].area=hr(h),i.push(h)}var u=t.map(function(h){return h.area>0?h.area:1/0});return u},dr=(t,e)=>{let r=[];var i=[];let n=0;for(let s of t){var a=s;s.length>e&&(console.log("LineString with length: ",s.length),a=fr(s,e)),i.length>0&&n+a.length>e&&(r.push(i),i=[],n=0),i.push(a),n+=s.length}return i.length>0&&r.push(i),r},Yi=t=>{var e=0;for(let r of t)e+=r.length;return e},mr=(t,e)=>{let r=[],i=[];for(let u of t)i.length>0&&!Oe(u)&&(r.push(i),i=[]),i.push(u);i.length>0&&r.push(i);let n=[];var a=[],s=0;for(let u of r){var o=u,l=Yi(u);l>e&&(o=fr(u,e),l=e),a.length>0&&s+l>e&&(n.push(a),a=[],s=0),a=a.concat(o),s+=l}return a.length>0&&n.push(a),n};var j;(function(i){i[i.Point=1]="Point",i[i.Line=2]="Line",i[i.Polygon=3]="Polygon"})(j||(j={}));function Q(t){return t.x+":"+t.y+":"+t.z}var Ei=(t,e,r)=>{t.pos=e;for(var i=t.readVarint()+t.pos,n=1,a=0,s=0,o=0,l=1/0,u=-1/0,h=1/0,d=-1/0,m=[],b;t.pos<i;){if(a<=0){var x=t.readVarint();n=x&7,a=x>>3}if(a--,n===1||n===2)s+=t.readSVarint()*r,o+=t.readSVarint()*r,s<l&&(l=s),s>u&&(u=s),o<h&&(h=o),o>d&&(d=o),n===1&&(b&&m.push(b),b=[]),b.push(new He.default(s,o));else if(n===7)b&&b.push(b[0].clone());else throw new Error("unknown command "+n)}return b&&m.push(b),{geom:m,bbox:{minX:l,minY:h,maxX:u,maxY:d}}};function br(t,e){let r=new cr.VectorTile(new pr.default(t)),i=new Map;for(let[n,a]of Object.entries(r.layers)){let s=[],o=a;for(let l=0;l<o.length;l++){let u=Ei(o.feature(l)._pbf,o.feature(l)._geometry,e/o.extent),h=0;for(let m of u.geom)h+=m.length;let d=[];if(h>H&&o.feature(l).type!=1){o.feature(l).type==2?d=dr(u.geom,H):d=mr(u.geom,H);for(let m of d)s.push({id:o.feature(l).id,geomType:o.feature(l).type,geom:m,numVertices:h,bbox:u.bbox,props:o.feature(l).properties})}else s.push({id:o.feature(l).id,geomType:o.feature(l).type,geom:u.geom,numVertices:h,bbox:u.bbox,props:o.feature(l).properties})}i.set(n,s)}return i}var K=class{constructor(e,r){e.url?this.p=e:this.p=new ke(e),this.controllers=[],this.shouldCancelZooms=r}get(e,r){return Y(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(s=>s[0]!=e.z?(s[1].abort(),!1):!0));let i=yield this.p.getZxy(e.z,e.x,e.y);if(!i)throw new Error(`Tile ${e.z} ${e.x} ${e.y} not found in archive`);let n=new AbortController;this.controllers.push([e.z,n]);let a=n.signal;return new Promise((s,o)=>{fetch(this.p.url,{headers:{Range:"bytes="+i[0]+"-"+(i[0]+i[1]-1)},signal:a}).then(l=>l.arrayBuffer()).then(l=>{let u=br(l,r);s(u)}).catch(l=>{o(l)})})})}},pe=class{constructor(e,r){this.url=e,this.controllers=[],this.shouldCancelZooms=r}get(e,r){return Y(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(s=>s[0]!=e.z?(s[1].abort(),!1):!0));let i=this.url.replace("{z}",e.z.toString()).replace("{x}",e.x.toString()).replace("{y}",e.y.toString()),n=new AbortController;this.controllers.push([e.z,n]);let a=n.signal;return new Promise((s,o)=>{fetch(i,{signal:a}).then(l=>l.arrayBuffer()).then(l=>{let u=br(l,r);s(u)}).catch(l=>{o(l)})})})}},dt=6378137,xr=85.0511287798,Je=dt*Math.PI,Ri=t=>{let e=Math.PI/180,r=Math.max(Math.min(xr,t[0]),-xr),i=Math.sin(r*e);return new He.default(dt*t[1]*e,dt*Math.log((1+i)/(1-i))/2)};function yr(t){return t*t}function Ge(t,e){return yr(t.x-e.x)+yr(t.y-e.y)}function Ii(t,e,r){var i=Ge(e,r);if(i===0)return Ge(t,e);var n=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/i;return n=Math.max(0,Math.min(1,n)),Ge(t,{x:e.x+n*(r.x-e.x),y:e.y+n*(r.y-e.y)})}function mt(t,e){for(var r=!1,i=0,n=e.length-1;i<e.length;n=i++){var a=e[i].x,s=e[i].y,o=e[n].x,l=e[n].y,u=s>t.y!=l>t.y&&t.x<(o-a)*(t.y-s)/(l-s)+a;u&&(r=!r)}return r}function Oe(t){for(var e=0,r=0;r<t.length;r++){let i=(r+1)%t.length;e+=t[r].x*t[i].y,e-=t[i].x*t[r].y}return e<0}function gr(t,e){var r=!1;for(let i of e)if(Oe(i))mt(t,i)&&(r=!1);else{if(r)return!0;mt(t,i)&&(r=!0)}return r}function wr(t,e){let r=1/0;for(let i of e){let n=Math.sqrt(Ge(t,i[0]));n<r&&(r=n)}return r}function vr(t,e){let r=1/0;for(let n of e)for(var i=0;i<n.length-1;i++){let a=Math.sqrt(Ii(t,n[i],n[i+1]));a<r&&(r=a)}return r}var be=class{constructor(e,r){this.source=e,this.cache=new Map,this.inflight=new Map,this.tileSize=r}queryFeatures(e,r,i,n){let a=Ri([r,e]);var s=new He.default((a.x+Je)/(Je*2),1-(a.y+Je)/(Je*2));s.x>1&&(s.x=s.x-Math.floor(s.x));let o=s.mult(1<<i),l=Math.floor(o.x),u=Math.floor(o.y),h=Q({z:i,x:l,y:u}),d=[],m=this.cache.get(h);if(m){let b={x:(o.x-l)*this.tileSize,y:(o.y-u)*this.tileSize};for(let[x,w]of m.data.entries())for(let f of w)f.geomType==1?wr(b,f.geom)<n&&d.push({feature:f,layerName:x}):f.geomType==2?vr(b,f.geom)<n&&d.push({feature:f,layerName:x}):gr(b,f.geom)&&d.push({feature:f,layerName:x})}return d}get(e){return Y(this,null,function*(){let r=Q(e);return new Promise((i,n)=>{let a=this.cache.get(r);if(a)a.used=performance.now(),i(a.data);else{let s=this.inflight.get(r);s?s.push([i,n]):(this.inflight.set(r,[]),this.source.get(e,this.tileSize).then(o=>{this.cache.set(r,{used:performance.now(),data:o});let l=this.inflight.get(r);if(l&&l.forEach(u=>u[0](o)),this.inflight.delete(r),i(o),this.cache.size>=64){let u=1/0,h;this.cache.forEach((d,m)=>{d.used<u&&(u=d.used,h=m)}),h&&this.cache.delete(h)}}).catch(o=>{let l=this.inflight.get(r);l&&l.forEach(u=>u[1](o)),this.inflight.delete(r),n(o)}))}})})}};var ie=R($());var U;(function(n){n.TileFetchStart="tile-fetch-start",n.TileFetchEnd="tile-fetch-end",n.RerenderStart="rerender-start",n.RerenderEnd="rerender-end"})(U||(U={}));var ct=class{constructor(){this.subs={}}subscribe(e,r){this.subs[e]=this.subs[e]||[],this.subs[e].push(r)}publish(e,...r){(this.subs[e]||[]).forEach(i=>i(...r))}};var ne=(t,e,r)=>{let i=[];for(let n of t){let a=[];for(let s of n)a.push(s.clone().mult(e).add(r));i.push(a)}return i},De=(t,e)=>{let r=1<<e;return t<0&&(t=r+t),t>=r&&(t=t%r),t},xe=class{constructor(e,r,i,n){this.tileCache=e,this.maxDataLevel=r,this.levelDiff=i,this.eventQueue=n}dataTilesForBounds(e,r){let i=Math.pow(2,e)/Math.pow(2,Math.ceil(e)),n=[];var a=1,s=this.tileCache.tileSize;if(e<this.levelDiff)a=1/(1<<this.levelDiff-e)*i,n.push({data_tile:{z:0,x:0,y:0},origin:new ie.default(0,0),scale:a,dim:s*a});else if(e<=this.levelDiff+this.maxDataLevel){let u=1<<this.levelDiff,h=256*i,d=Math.ceil(e)-this.levelDiff,m=Math.floor(r.minX/u/h),b=Math.floor(r.minY/u/h),x=Math.floor(r.maxX/u/h),w=Math.floor(r.maxY/u/h);for(var o=m;o<=x;o++)for(var l=b;l<=w;l++){let f=new ie.default(o*u*h,l*u*h);n.push({data_tile:{z:d,x:De(o,d),y:De(l,d)},origin:f,scale:i,dim:s*i})}}else{let u=1<<this.levelDiff;a=(1<<Math.ceil(e)-this.maxDataLevel-this.levelDiff)*i;let h=Math.floor(r.minX/u/256/a),d=Math.floor(r.minY/u/256/a),m=Math.floor(r.maxX/u/256/a),b=Math.floor(r.maxY/u/256/a);for(var o=h;o<=m;o++)for(var l=d;l<=b;l++){let f=new ie.default(o*u*256*a,l*u*256*a);n.push({data_tile:{z:this.maxDataLevel,x:De(o,this.maxDataLevel),y:De(l,this.maxDataLevel)},origin:f,scale:a,dim:s*a})}}return n}dataTileForDisplayTile(e){var r,i=1,n=this.tileCache.tileSize,a;if(e.z<this.levelDiff)r={z:0,x:0,y:0},i=1/(1<<this.levelDiff-e.z),a=new ie.default(0,0),n=n*i;else if(e.z<=this.levelDiff+this.maxDataLevel){let s=1<<this.levelDiff;r={z:e.z-this.levelDiff,x:Math.floor(e.x/s),y:Math.floor(e.y/s)},a=new ie.default(r.x*s*256,r.y*s*256)}else{i=1<<e.z-this.maxDataLevel-this.levelDiff;let s=1<<this.levelDiff;r={z:this.maxDataLevel,x:Math.floor(e.x/s/i),y:Math.floor(e.y/s/i)},a=new ie.default(r.x*s*i*256,r.y*s*i*256),n=n*i}return{data_tile:r,scale:i,origin:a,dim:n}}getBbox(e,r){return Y(this,null,function*(){var a,s;(a=this.eventQueue)==null||a.publish(U.TileFetchStart);let i=this.dataTilesForBounds(e,r),n=yield Promise.all(i.map(o=>this.tileCache.get(o.data_tile)));return(s=this.eventQueue)==null||s.publish(U.TileFetchEnd),n.map((o,l)=>{let u=i[l];return{data:o,z:e,data_tile:u.data_tile,scale:u.scale,dim:u.dim,origin:u.origin}})})}getDisplayTile(e){return Y(this,null,function*(){let r=this.dataTileForDisplayTile(e);return{data:yield this.tileCache.get(r.data_tile),z:e.z,data_tile:r.data_tile,scale:r.scale,origin:r.origin,dim:r.dim}})}queryFeatures(e,r,i){let n=Math.round(i),a=Math.min(n-this.levelDiff,this.maxDataLevel),s=16/(1<<n-a);return this.tileCache.queryFeatures(e,r,a,s)}};var Qe=R($());function pt(t,e,r,i,n,a){let s=performance.now(),o=["crimson","lightgreen","lightseagreen","mediumslateblue","purple","cornflowerblue"];t.save(),t.miterLimit=2;for(var l of e){let u=l.origin,h=l.scale,d=l.dim;if(t.save(),n){t.beginPath();let m=Math.max(u.x-i.x,r.minX-i.x)-.5,b=Math.max(u.y-i.y,r.minY-i.y)-.5,x=Math.min(u.x-i.x+d,r.maxX-i.x)+.5,w=Math.min(u.y-i.y+d,r.maxY-i.y)+.5;t.rect(m,b,x-m,w-b),t.clip()}t.translate(u.x-i.x,u.y-i.y),n&&(t.translate(d/2,d/2),t.scale(1+1/d,1+1/d),t.translate(-d/2,-d/2)),l.data.forEach((m,b)=>{if(b=="earth")return;let x=o[b.charCodeAt(0)%6],w=new J({fill:x,opacity:.8}),f=new A({per_feature:!0,color:x,opacity:.5}),c=new D({per_feature:!0,fill:x,opacity:.3});f.before(t,l.z),c.before(t,l.z);for(var p of m){let v=p.geom,y=p.bbox;y.maxX*h+u.x<r.minX||y.minX*h+u.x>r.maxX||y.minY*h+u.y>r.maxY||y.maxY*h+u.y<r.minY||(h!=1&&(v=ne(v,h,new Qe.default(0,0))),p.geomType==j.Point?w.draw(t,v,l.z,p):(p.geomType==j.Line||c.draw(t,v,l.z,p),f.draw(t,v,l.z,p)))}}),t.restore()}return n&&(t.beginPath(),t.rect(r.minX-i.x,r.minY-i.y,r.maxX-r.minX,r.maxY-r.minY),t.clip()),t.restore(),performance.now()-s}var _r=(t,e,r,i)=>{let n=t.bbox;return!(n.maxX*e+r.x<i.minX||n.minX*e+r.x>i.maxX||n.minY*e+r.y>i.maxY||n.maxY*e+r.y<i.minY)};function Be(t,e,r,i,n,a,s,o){let l=performance.now();t.save(),t.miterLimit=2;for(var u of e){let x=u.origin,w=u.scale,f=u.dim;if(t.save(),s){t.beginPath();let c=Math.max(x.x-a.x,n.minX-a.x)-.5,p=Math.max(x.y-a.y,n.minY-a.y)-.5,v=Math.min(x.x-a.x+f,n.maxX-a.x)+.5,y=Math.min(x.y-a.y+f,n.maxY-a.y)+.5;t.rect(c,p,v-c,y-p),t.clip()}t.translate(x.x-a.x,x.y-a.y),s&&(t.translate(f/2,f/2),t.scale(1+1/f,1+1/f),t.translate(-f/2,-f/2));for(var h of i)if(!(h.minzoom&&u.z<h.minzoom)&&!(h.maxzoom&&u.z>h.maxzoom)){var d=u.data.get(h.dataLayer);if(d!==void 0){if(h.symbolizer.before&&h.symbolizer.before(t,u.z),h.symbolizer.drawGrouped)h.symbolizer.drawGrouped(t,u.z,d,c=>_r(c,w,x,n),w!=1?c=>ne(c,w,new Qe.default(0,0)):c=>c,c=>h.filter?h.filter(u.z,c):!0);else if(h.symbolizer.draw)for(var m of d){let c=m.geom;!_r(m,w,x,n)||h.filter&&!h.filter(u.z,m)||(w!=1&&(c=ne(c,w,new Qe.default(0,0))),h.symbolizer.draw(t,c,u.z,m))}}}t.restore()}if(s&&(t.beginPath(),t.rect(n.minX-a.x,n.minY-a.y,n.maxX-n.minX,n.maxY-n.minY),t.clip()),r){let x=r.searchBbox(n,1/0);for(var b of x)if(t.save(),t.translate(b.anchor.x-a.x,b.anchor.y-a.y),b.draw(t),t.restore(),o){t.lineWidth=.5,t.strokeStyle=o,t.fillStyle=o,t.globalAlpha=1,t.fillRect(b.anchor.x-a.x-2,b.anchor.y-a.y-2,4,4);for(let w of b.bboxes)t.strokeRect(w.minX-a.x,w.minY-a.y,w.maxX-w.minX,w.maxY-w.minY)}}return t.restore(),performance.now()-l}var zr=R($());var Lr=R(Fr()),Sr=(t,e,r)=>{let i=256,n=e/i,a=Math.floor(r.minX/i),s=Math.floor(r.minY/i),o=Math.floor(r.maxX/i),l=Math.floor(r.maxY/i),u=Math.log2(n),h=[];for(let d=a;d<=o;d++){let m=d%(1<<t);for(let b=s;b<=l;b++)h.push({display:Q({z:t,x:m,y:b}),key:Q({z:t-u,x:Math.floor(m/n),y:Math.floor(b/n)})})}return h},yt=class{constructor(e){this.tree=new Lr.default,this.current=new Map,this.dim=e}has(e){return this.current.has(e)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(e,r){let i=new Set;for(let n of this.tree.search(e))n.indexed_label.order<=r&&i.add(n.indexed_label);return i}searchLabel(e,r){let i=new Set;for(let n of e.bboxes)for(let a of this.tree.search(n))a.indexed_label.order<=r&&i.add(a.indexed_label);return i}bboxCollides(e,r){for(let i of this.tree.search(e))if(i.indexed_label.order<=r)return!0;return!1}labelCollides(e,r){for(let i of e.bboxes)for(let n of this.tree.search(i))if(n.indexed_label.order<=r)return!0;return!1}deduplicationCollides(e){if(!e.deduplicationKey||!e.deduplicationDistance)return!1;let r=e.deduplicationDistance,i={minX:e.anchor.x-r,minY:e.anchor.y-r,maxX:e.anchor.x+r,maxY:e.anchor.y+r};for(let n of this.tree.search(i))if(n.indexed_label.deduplicationKey===e.deduplicationKey&&n.indexed_label.anchor.dist(e.anchor)<r)return!0;return!1}insert(e,r,i){let n={anchor:e.anchor,bboxes:e.bboxes,draw:e.draw,order:r,tileKey:i,deduplicationKey:e.deduplicationKey,deduplicationDistance:e.deduplicationDistance},a=this.current.get(i);if(a)a.add(n);else{let d=new Set;d.add(n),this.current.set(i,d)}var s=!1,o=!1;for(let d of e.bboxes){var l=d;l.indexed_label=n,this.tree.insert(l),d.minX<0&&(s=!0),d.maxX>this.dim&&(o=!0)}if(s||o){var u=s?this.dim:-this.dim,h=[];for(let b of e.bboxes)h.push({minX:b.minX+u,minY:b.minY,maxX:b.maxX+u,maxY:b.maxY});let d={anchor:new zr.default(e.anchor.x+u,e.anchor.y),bboxes:h,draw:e.draw,order:r,tileKey:i},m=this.current.get(i);m&&m.add(d);for(let b of h){var l=b;l.indexed_label=d,this.tree.insert(l)}}}prune(e){let r=this.current.get(e);if(!r)return;let i=[];for(let n of this.tree.all())r.has(n.indexed_label)&&i.push(n);i.forEach(n=>{this.tree.remove(n)}),this.current.delete(e)}removeLabel(e){let r=[];for(let n of this.tree.all())e==n.indexed_label&&r.push(n);r.forEach(n=>{this.tree.remove(n)});let i=this.current.get(e.tileKey);i&&i.delete(e)}},Xe=class{constructor(e,r,i,n,a){this.index=new yt(256*1<<e),this.z=e,this.scratch=r,this.labelRules=i,this.callback=a,this.maxLabeledTiles=n}layout(e){let r=performance.now(),i=Q(e.data_tile),n=new Set;for(let[s,o]of this.labelRules.entries()){if(o.visible==!1||o.minzoom&&this.z<o.minzoom||o.maxzoom&&this.z>o.maxzoom)continue;let l=e.data.get(o.dataLayer);if(l===void 0)continue;let u=l;o.sort&&u.sort((d,m)=>o.sort?o.sort(d.props,m.props):0);let h={index:this.index,zoom:this.z,scratch:this.scratch,order:s,overzoom:this.z-e.data_tile.z};for(let d of u){if(o.filter&&!o.filter(this.z,d))continue;let m=ne(d.geom,e.scale,e.origin),b=o.symbolizer.place(h,m,d);if(!!b)for(let x of b){var a=!1;if(!(x.deduplicationKey&&this.index.deduplicationCollides(x))){if(this.index.labelCollides(x,1/0)){if(!this.index.labelCollides(x,s)){let w=this.index.searchLabel(x,1/0);for(let f of w){this.index.removeLabel(f);for(let c of f.bboxes)this.findInvalidatedTiles(n,e.dim,c,i)}this.index.insert(x,s,i),a=!0}}else this.index.insert(x,s,i),a=!0;if(a)for(let w of x.bboxes)(w.maxX>e.origin.x+e.dim||w.minX<e.origin.x||w.minY<e.origin.y||w.maxY>e.origin.y+e.dim)&&this.findInvalidatedTiles(n,e.dim,w,i)}}}}return n.size>0&&this.callback&&this.callback(n),performance.now()-r}findInvalidatedTiles(e,r,i,n){let a=Sr(this.z,r,i);for(let s of a)s.key!=n&&this.index.has(s.key)&&e.add(s.display)}pruneCache(e){if(this.index.size()>this.maxLabeledTiles){let r,i=0;for(let n of this.index.keys()){let a=n.split(":"),s=Math.sqrt(Math.pow(+a[0]-e.data_tile.x,2)+Math.pow(+a[1]-e.data_tile.y,2));s>i&&(i=s,r=n)}r&&this.index.prune(r)}}add(e){let r=Q(e.data_tile);if(this.index.has(r))return 0;{let i=this.layout(e);return this.pruneCache(e),i}}},Ae=class{constructor(e,r,i,n){this.labelers=new Map,this.scratch=e,this.labelRules=r,this.maxLabeledTiles=i,this.callback=n}add(e){var r=this.labelers.get(e.z);return r||(r=new Xe(e.z,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(e.z,r)),r.add(e)}getIndex(e){let r=this.labelers.get(e);if(r)return r.index}};var ye={earth:"#FFFBF6",glacier:"#ffffff",residential:"#F4F4F8",hospital:"#FFF6F6",cemetery:"#EFF2EE",school:"#F7F6FF",industrial:"#FFF9EF",wood:"#F4F9EF",grass:"#EBF9E3",park:"#E5F9D5",water:"#B7DFF2",sand:"#ebebeb",buildings:"#F2EDE8",highwayCasing:"#FFC3C3",majorRoadCasing:"#FFB9B9",mediumRoadCasing:"#FFCE8E",minorRoadCasing:"#cccccc",highway:"#FFCEBB",majorRoad:"#FFE4B3",mediumRoad:"#FFF2C8",minorRoad:"#ffffff",boundaries:"#9e9e9e",mask:"#dddddd",countryLabel:"#aaaaaa",cityLabel:"#6C6C6C",stateLabel:"#999999",neighbourhoodLabel:"#888888",landuseLabel:"#898989",waterLabel:"#41ABDC",naturalLabel:"#4B8F14",roadsLabel:"#888888",poisLabel:"#606060"};var ge={earth:"#151515",glacier:"#1c1c1c",residential:"#252B2F",hospital:"#3E2C2C",cemetery:"#36483D",school:"#2C3440",industrial:"#33312C",wood:"#3A3E38",grass:"#4E604D",park:"#2C4034",water:"#4D5B73",sand:"#777777",buildings:"#464545",highwayCasing:"#000000",majorRoadCasing:"#1C1B1B",mediumRoadCasing:"#3E3E3E",minorRoadCasing:"#000000",highway:"#5B5B5B",majorRoad:"#595959",mediumRoad:"#4F4F4F",minorRoad:"#393939",boundaries:"#666666",mask:"#dddddd",countryLabel:"#ffffff",cityLabel:"#FFFFFF",stateLabel:"#ffffff",neighbourhoodLabel:"#FDFDFD",landuseLabel:"#DDDDDD",waterLabel:"#707E95",naturalLabel:"#4c4c4c",roadsLabel:"#C4C4C4",poisLabel:"#959393"};function Ye(t,e,r){return Math.min(Math.max(t,r),e)}var we=class extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}};function Vi(t){if(typeof t!="string")throw new we(t);if(t.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=t.trim();e=Zi.test(t)?function(s){let o=s.toLowerCase().trim(),l=ji[function(u){let h=5381,d=u.length;for(;d;)h=33*h^u.charCodeAt(--d);return(h>>>0)%2341}(o)];if(!l)throw new we(s);return`#${l}`}(t):t;let r=qi.exec(e);if(r){let s=Array.from(r).slice(1);return[...s.slice(0,3).map(o=>parseInt(Ee(o,2),16)),parseInt(Ee(s[3]||"f",2),16)/255]}let i=Ni.exec(e);if(i){let s=Array.from(i).slice(1);return[...s.slice(0,3).map(o=>parseInt(o,16)),parseInt(s[3]||"ff",16)/255]}let n=Wi.exec(e);if(n){let s=Array.from(n).slice(1);return[...s.slice(0,3).map(o=>parseInt(o,10)),parseFloat(s[3]||"1")]}let a=$i.exec(e);if(a){let[s,o,l,u]=Array.from(a).slice(1).map(parseFloat);if(Ye(0,100,o)!==o)throw new we(t);if(Ye(0,100,l)!==l)throw new we(t);return[...Ui(s,o,l),u||1]}throw new we(t)}var kr=t=>parseInt(t.replace(/_/g,""),36),ji="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((t,e)=>{let r=kr(e.substring(0,3)),i=kr(e.substring(3)).toString(16),n="";for(let a=0;a<6-i.length;a++)n+="0";return t[r]=`${n}${i}`,t},{}),Ee=(t,e)=>Array.from(Array(e)).map(()=>t).join(""),qi=new RegExp(`^#${Ee("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Ni=new RegExp(`^#${Ee("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Wi=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${Ee(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),$i=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,Zi=/^[a-z]+$/i,Mr=t=>Math.round(255*t),Ui=(t,e,r)=>{let i=r/100;if(e===0)return[i,i,i].map(Mr);let n=(t%360+360)%360/60,a=(1-Math.abs(2*i-1))*(e/100),s=a*(1-Math.abs(n%2-1)),o=0,l=0,u=0;n>=0&&n<1?(o=a,l=s):n>=1&&n<2?(o=s,l=a):n>=2&&n<3?(l=a,u=s):n>=3&&n<4?(l=s,u=a):n>=4&&n<5?(o=s,u=a):n>=5&&n<6&&(o=a,u=s);let h=i-a/2;return[o+h,l+h,u+h].map(Mr)};function gt(t){let[e,r,i,n]=Vi(t).map((u,h)=>h===3?u:u/255),a=Math.max(e,r,i),s=Math.min(e,r,i),o=(a+s)/2;if(a===s)return[0,0,o,n];let l=a-s;return[60*(e===a?(r-i)/l+(r<i?6:0):r===a?(i-e)/l+2:(e-r)/l+4),o>.5?l/(2-a-s):l/(a+s),o,n]}function Pr(t,e,r,i){return`hsla(${(t%360).toFixed()}, ${Ye(0,100,100*e).toFixed()}%, ${Ye(0,100,100*r).toFixed()}%, ${parseFloat(Ye(0,1,i).toFixed(3))})`}var Cr=(t,e)=>{let r=gt(e),i=Pt({},t);for(let[n,a]of Object.entries(t)){let s=gt(a);i[n]=Pr(r[0],r[1],s[2],s[3])}return i},ve=(t,e)=>(e&&(t=Cr(t,e)),[{dataLayer:"earth",symbolizer:new D({fill:t.earth})},{dataLayer:"natural",symbolizer:new D({fill:t.glacier}),filter:(r,i)=>i.props.natural=="glacier"},{dataLayer:"landuse",symbolizer:new D({fill:t.residential}),filter:(r,i)=>i.props.landuse=="residential"||i.props.place=="neighbourhood"},{dataLayer:"landuse",symbolizer:new D({fill:t.hospital}),filter:(r,i)=>i.props.amenity=="hospital"},{dataLayer:"landuse",symbolizer:new D({fill:t.cemetery}),filter:(r,i)=>i.props.landuse=="cemetery"},{dataLayer:"landuse",symbolizer:new D({fill:t.school}),filter:(r,i)=>i.props.amenity=="school"||i.props.amenity=="kindergarten"||i.props.amenity=="university"||i.props.amenity=="college"},{dataLayer:"landuse",symbolizer:new D({fill:t.industrial}),filter:(r,i)=>i.props.landuse=="industrial"},{dataLayer:"natural",symbolizer:new D({fill:t.wood}),filter:(r,i)=>i.props.natural=="wood"},{dataLayer:"landuse",symbolizer:new D({fill:t.grass}),filter:(r,i)=>i.props.landuse=="grass"},{dataLayer:"landuse",symbolizer:new D({fill:t.park}),filter:(r,i)=>i.props.leisure=="park"},{dataLayer:"water",symbolizer:new D({fill:t.water})},{dataLayer:"natural",symbolizer:new D({fill:t.sand}),filter:(r,i)=>i.props.natural=="sand"},{dataLayer:"buildings",symbolizer:new D({fill:t.buildings})},{dataLayer:"roads",symbolizer:new A({color:t.highwayCasing,width:V(1.4,[[5,1.5],[11,4],[16,9],[20,40]])}),filter:(r,i)=>i.props["pmap:kind"]=="highway"},{dataLayer:"roads",symbolizer:new A({color:t.majorRoadCasing,width:V(1.4,[[9,3],[12,4],[17,8],[20,22]])}),filter:(r,i)=>i.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new A({color:t.mediumRoadCasing,width:V(1.4,[[13,3],[17,6],[20,18]])}),filter:(r,i)=>i.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new A({color:t.minorRoadCasing,width:V(1.4,[[14,2],[17,5],[20,15]])}),filter:(r,i)=>i.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new A({color:t.minorRoad,width:V(1.4,[[14,1],[17,3],[20,13]])}),filter:(r,i)=>i.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new A({color:t.mediumRoad,width:V(1.4,[[13,2],[17,4],[20,15]])}),filter:(r,i)=>i.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new A({color:t.majorRoad,width:V(1.4,[[9,2],[12,3],[17,6],[20,20]])}),filter:(r,i)=>i.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new A({color:t.highway,width:V(1.4,[[5,.5],[11,2.5],[16,7],[20,30]])}),filter:(r,i)=>i.props["pmap:kind"]=="highway"},{dataLayer:"boundaries",symbolizer:new A({color:t.boundaries,width:2,opacity:.4})},{dataLayer:"mask",symbolizer:new D({fill:t.mask})}]),_e=(t,e,r,i)=>{e&&(t=Cr(t,e));var n=["name"];r&&(n=r);let a=(s,o)=>i?s instanceof re?new Ce([s,new re({fill:o,label_props:i})],{}):new Ce([s,new Z({fill:o,label_props:i})],{}):s;return[{dataLayer:"places",symbolizer:a(new Z({label_props:n,fill:t.countryLabel,lineHeight:1.5,font:(s,o)=>s<6?"200 14px sans-serif":"200 20px sans-serif",textTransform:"uppercase"}),t.countryLabel),filter:(s,o)=>o.props["pmap:kind"]=="country"},{dataLayer:"places",symbolizer:a(new Z({label_props:n,fill:t.stateLabel,font:"300 16px sans-serif"}),t.stateLabel),filter:(s,o)=>o.props["pmap:kind"]=="state"},{id:"cities_high",dataLayer:"places",filter:(s,o)=>o.props["pmap:kind"]=="city",minzoom:7,symbolizer:a(new Z({label_props:n,fill:t.cityLabel,font:(s,o)=>o.props["pmap:rank"]==1?s>8?"600 20px sans-serif":"600 12px sans-serif":s>8?"600 16px sans-serif":"600 10px sans-serif"}),t.cityLabel),sort:(s,o)=>s["pmap:rank"]-o["pmap:rank"]},{id:"cities_low",dataLayer:"places",filter:(s,o)=>o.props["pmap:kind"]=="city",maxzoom:6,symbolizer:new Te([new J({radius:2,fill:t.cityLabel}),a(new re({label_props:n,fill:t.cityLabel,offset:2,font:(s,o)=>o.props["pmap:rank"]==1?s>8?"600 20px sans-serif":"600 12px sans-serif":s>8?"600 16px sans-serif":"600 10px sans-serif"}),t.cityLabel)]),sort:(s,o)=>s["pmap:rank"]-o["pmap:rank"]},{id:"neighbourhood",dataLayer:"places",symbolizer:a(new Z({label_props:n,fill:t.neighbourhoodLabel,font:"500 10px sans-serif",textTransform:"uppercase"}),t.neighbourhoodLabel),filter:(s,o)=>o.props["pmap:kind"]=="neighbourhood"},{dataLayer:"landuse",symbolizer:a(new ce({label_props:n,fill:t.landuseLabel,font:"300 12px sans-serif"}),t.landuseLabel)},{dataLayer:"water",symbolizer:a(new ce({label_props:n,fill:t.waterLabel,font:"italic 600 12px sans-serif"}),t.waterLabel)},{dataLayer:"natural",symbolizer:a(new ce({label_props:n,fill:t.naturalLabel,font:"italic 300 12px sans-serif"}),t.naturalLabel)},{dataLayer:"roads",symbolizer:a(new me({label_props:n,fill:t.roadsLabel,font:"500 12px sans-serif"}),t.roadsLabel),minzoom:12},{dataLayer:"roads",symbolizer:new Ze({label_props:["ref"],font:"600 9px sans-serif",background:t.highway,padding:2,fill:t.neighbourhoodLabel}),filter:(s,o)=>o.props["pmap:kind"]=="highway"},{dataLayer:"pois",symbolizer:new Te([new J({radius:2,fill:t.poisLabel}),a(new re({label_props:n,fill:t.poisLabel,offset:2,font:"300 10px sans-serif"}),t.poisLabel)])}]};var Re=6378137,Tr=85.0511287798,q=Re*Math.PI,Dr=t=>{let e=Math.PI/180,r=Math.max(Math.min(Tr,t[0]),-Tr),i=Math.sin(r*e);return new ae.default(Re*t[1]*e,Re*Math.log((1+i)/(1-i))/2)},Oi=t=>{var e=180/Math.PI;return{lat:(2*Math.atan(Math.exp(t.y/Re))-Math.PI/2)*e,lng:t.x*e/Re}},Hi=(t,e)=>r=>{let i=Dr(r);return new ae.default((i.x+q)/(q*2),1-(i.y+q)/(q*2)).mult((1<<e)*256).sub(t)},Ji=(t,e)=>r=>{console.log(r);let i=new ae.default(r.x,r.y).add(t).div((1<<e)*256),n=new ae.default(i.x*(q*2)-q,(1-i.y)*(q*2)-q);return Oi(n)},wt=(t,e)=>{let r=e*(360/t);return Math.log2(r/256)},Br=class{constructor(e){let r=e.dark?ge:ye;this.paint_rules=e.paint_rules||ve(r,e.shade),this.label_rules=e.label_rules||_e(r,e.shade,e.language1,e.language2),this.backgroundColor=e.backgroundColor;let i;e.url.url?i=new K(e.url,!1):e.url.endsWith(".pmtiles")?i=new K(e.url,!1):i=new pe(e.url,!1);let n=14;e.maxDataZoom&&(n=e.maxDataZoom);let a=e.levelDiff===void 0?2:e.levelDiff,s=new be(i,256*1<<a);this.view=new xe(s,n,a),this.debug=e.debug||!1}drawContext(e,r,i,n,a){return Y(this,null,function*(){let s=Dr(n),l=new ae.default((s.x+q)/(q*2),1-(s.y+q)/(q*2)).clone().mult(Math.pow(2,a)*256).sub(new ae.default(r/2,i/2)),u={minX:l.x,minY:l.y,maxX:l.x+r,maxY:l.y+i},h=yield this.view.getBbox(a,u),d=performance.now(),m=new Xe(a,e,this.label_rules,16,void 0);for(var b of h)yield m.add(b);this.backgroundColor&&(e.save(),e.fillStyle=this.backgroundColor,e.fillRect(0,0,r,i),e.restore());let x=Be(e,h,m.index,this.paint_rules,u,l,!0,this.debug);if(this.debug){e.save(),e.translate(-l.x,-l.y);for(var b of h)e.strokeStyle=this.debug,e.strokeRect(b.origin.x,b.origin.y,b.dim,b.dim);e.restore()}return{elapsed:performance.now()-d,project:Hi(l,a),unproject:Ji(l,a)}})}drawCanvas(a,s,o){return Y(this,arguments,function*(e,r,i,n={}){let l=window.devicePixelRatio,u=e.clientWidth,h=e.clientHeight;e.sizeSet||(e.width=u*l,e.height=h*l,e.sizeSet=!0),e.lang=n.lang;let d=e.getContext("2d");return d.setTransform(l,0,0,l,0,0),this.drawContext(d,u,h,r,i)})}drawContextBounds(e,r,i,n,a){return Y(this,null,function*(){let s=i[0]-r[0],o=[(r[1]+i[1])/2,(r[0]+i[0])/2];return this.drawContext(e,n,a,o,wt(s,n))})}drawCanvasBounds(s,o,l,u){return Y(this,arguments,function*(e,r,i,n,a={}){let h=i[0]-r[0],d=[(r[1]+i[1])/2,(r[0]+i[0])/2];return this.drawCanvas(e,d,wt(h,n),a)})}};var Xr=R($());var Gi=t=>new Promise((e,r)=>{setTimeout(()=>{e()},t)}),Qi=t=>t.then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e})),Ki=t=>{class e extends L.GridLayer{constructor(i){i.noWrap&&!i.bounds&&(i.bounds=[[-90,-180],[90,180]]),i.attribution==null&&(i.attribution='<a href="https://protomaps.com">Protomaps</a> \xA9 <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>');super(i);let n=i.dark?ge:ye;this.paint_rules=i.paint_rules||ve(n,i.shade),this.label_rules=i.label_rules||_e(n,i.shade,i.language1,i.language2),this.backgroundColor=i.backgroundColor,this.lastRequestedZ=void 0,this.xray=i.xray;let a;i.url.url?a=new K(i.url,!0):i.url.endsWith(".pmtiles")?a=new K(i.url,!0):a=new pe(i.url,!0);let s=14;i.maxDataZoom&&(s=i.maxDataZoom),this.levelDiff=i.levelDiff===void 0?2:i.levelDiff,this.eventQueue=new ct,this.subscribeChildEvents(),this.tasks=i.tasks||[];let o=new be(a,256*1<<this.levelDiff);this.view=new xe(o,s,this.levelDiff,this.eventQueue),this.debug=i.debug;let l=document.createElement("canvas").getContext("2d");this.scratch=l,this.onTilesInvalidated=u=>{u.forEach(h=>{this.rerenderTile(h)})},this.labelers=new Ae(this.scratch,this.label_rules,16,this.onTilesInvalidated),this.tile_size=256*window.devicePixelRatio,this.tileDelay=i.tileDelay||3,this.lang=i.lang,this.inspector=this.inspect(this)}setDefaultStyle(i,n,a,s){let o=i?ge:ye;this.paint_rules=ve(o,n),this.label_rules=_e(o,n,a,s)}renderTile(i,n,a,s=()=>{}){return Y(this,null,function*(){this.lastRequestedZ=i.z;var o;try{o=yield this.view.getDisplayTile(i)}catch(y){if(y.name=="AbortError")return;throw y}if(n.key!=a||this.lastRequestedZ!==i.z||(yield Promise.all(this.tasks.map(Qi)),n.key!=a)||this.lastRequestedZ!==i.z)return;let l=yield this.labelers.add(o);if(n.key!=a||this.lastRequestedZ!==i.z)return;let u=this.labelers.getIndex(o.z);if(!this._map)return;let h=this._map.getCenter().wrap(),d=this._getTiledPixelBounds(h),m=this._pxBoundsToTileRange(d),b=m.getCenter(),x=i.distanceTo(b)*this.tileDelay;if(yield Gi(x),n.key!=a||this.lastRequestedZ!==i.z)return;let w=16,f={minX:256*i.x-w,minY:256*i.y-w,maxX:256*(i.x+1)+w,maxY:256*(i.y+1)+w},c=new Xr.default(256*i.x,256*i.y);n.width=this.tile_size,n.height=this.tile_size;let p=n.getContext("2d");p.setTransform(this.tile_size/256,0,0,this.tile_size/256,0,0),p.clearRect(0,0,256,256),this.backgroundColor&&(p.save(),p.fillStyle=this.backgroundColor,p.fillRect(0,0,256,256),p.restore());var v=0;if(this.xray?v=pt(p,[o],f,c,!1,this.debug):v=Be(p,[o],u,this.paint_rules,f,c,!1,this.debug),this.debug){let y=o.data_tile;p.save(),p.fillStyle=this.debug,p.font="600 12px sans-serif",p.fillText(i.z+" "+i.x+" "+i.y,4,14),p.font="200 12px sans-serif",p.fillText(y.z+" "+y.x+" "+y.y,4,28),p.font="600 10px sans-serif",v>8&&p.fillText(v.toFixed()+" ms paint",4,42),l>8&&p.fillText(l.toFixed()+" ms layout",4,56),p.strokeStyle=this.debug,p.lineWidth=i.x/(1<<this.levelDiff)===y.x?2.5:.5,p.beginPath(),p.moveTo(0,0),p.lineTo(0,256),p.stroke(),p.lineWidth=i.y/(1<<this.levelDiff)===y.y?2.5:.5,p.beginPath(),p.moveTo(0,0),p.lineTo(256,0),p.stroke(),p.restore()}s()})}rerenderTile(i){for(let n in this._tiles){let a=this._wrapCoords(this._keyToTileCoords(n));i===this._tileCoordsToKey(a)&&this.renderTile(a,this._tiles[n].el,i)}}clearLayout(){this.labelers=new Ae(this.scratch,this.label_rules,16,this.onTilesInvalidated)}rerenderTiles(){this.fire(U.RerenderStart);let i=[];for(let n in this._tiles){let a=this._wrapCoords(this._keyToTileCoords(n)),s=this._tileCoordsToKey(a);i.push(this.renderTile(a,this._tiles[n].el,s))}Promise.all(i).then(()=>this.fire(U.RerenderEnd))}createTile(i,n){let a=L.DomUtil.create("canvas","leaflet-tile");a.lang=this.lang;let s=this._tileCoordsToKey(i);return a.key=s,this.renderTile(i,a,s,()=>{n(null,a)}),a}_removeTile(i){let n=this._tiles[i];!n||(n.el.removed=!0,n.el.key=void 0,L.DomUtil.removeClass(n.el,"leaflet-tile-loaded"),L.DomUtil.remove(n.el),delete this._tiles[i],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(i)}))}queryFeatures(i,n){return this.view.queryFeatures(i,n,this._map.getZoom())}inspect(i){return n=>{let a=["Point","Line","Polygon"],s=i._map.wrapLatLng(n.latlng),o=i.queryFeatures(s.lng,s.lat);for(var l="",u=0;u<o.length;u++){let h=o[u];l=l+`<div><b>${h.layerName}</b> ${a[h.feature.geomType-1]} ${h.feature.id}</div>`;for(let d in h.feature.props)l=l+`<div>${d}=${h.feature.props[d]}</div>`;u<o.length-1&&(l=l+"<hr/>")}o.length==0&&(l="No features."),L.popup().setLatLng(n.latlng).setContent(l).openOn(i._map)}}addInspector(i){return i.on("click",this.inspector)}removeInspector(i){return i.off("click",this.inspector)}subscribeChildEvents(){this.eventQueue.subscribe(U.TileFetchStart,this.fireEvent),this.eventQueue.subscribe(U.TileFetchEnd,this.fireEvent)}fireEvent(i){this.fire(i)}}return new e(t)};var en=t=>{let e=0,r=0;for(let o of t)e+=o.w*o.h,r=Math.max(r,o.w);t.sort((o,l)=>l.h-o.h);let i=Math.max(Math.ceil(Math.sqrt(e/.95)),r),n=[{x:0,y:0,w:i,h:1/0}],a=0,s=0;for(let o of t)for(let l=n.length-1;l>=0;l--){let u=n[l];if(!(o.w>u.w||o.h>u.h)){if(o.x=u.x,o.y=u.y,s=Math.max(s,o.y+o.h),a=Math.max(a,o.x+o.w),o.w===u.w&&o.h===u.h){let h=n.pop();l<n.length&&(n[l]=h)}else o.h===u.h?(u.x+=o.w,u.w-=o.w):o.w===u.w?(u.y+=o.h,u.h-=o.h):(n.push({x:u.x+o.w,y:u.y,w:u.w-o.w,h:o.h}),u.y+=o.h,u.h-=o.h);break}}return{w:a,h:s,fill:e/(a*s)||0}},Ar=t=>new Promise((e,r)=>{let i=new Image;i.onload=()=>e(i),i.onerror=()=>r("Invalid SVG"),i.src=t}),tn=`
<svg width="20px" height="20px" viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <rect width="50" height="50" fill="#cccccc"/>
    <g transform="translate(5,5)">
        <path fill="none" stroke="#666666" stroke-width="7" d="m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7"/>
    </g>
</svg>
`,Ke=class{constructor(e){this.src=e,this.canvas=null}load(){return Y(this,null,function*(){let e=this.src,r=window.devicePixelRatio;e.endsWith(".html")&&(e=yield(yield fetch(e)).text());let n=new window.DOMParser().parseFromString(e,"text/html").body.children;this.mapping={};let a=yield Ar("data:image/svg+xml;base64,"+btoa(tn)),s=[{w:a.width*r,h:a.height*r,img:a}],o=new XMLSerializer;for(let m of n){var l=btoa(o.serializeToString(m)),u="data:image/svg+xml;base64,"+l;let b=yield Ar(u);s.push({w:b.width*r,h:b.height*r,img:b,id:m.id})}let h=en(s);this.canvas=document.createElement("canvas"),this.canvas.width=h.w,this.canvas.height=h.h;let d=this.canvas.getContext("2d");for(let m of s)d.drawImage(m.img,m.x,m.y,m.w,m.h),m.id?this.mapping[m.id]={x:m.x,y:m.y,w:m.w,h:m.h}:this.missingBox={x:m.x,y:m.y,w:m.w,h:m.h};return this})}get(e){let r=this.mapping[e];return r||(r=this.missingBox),r.canvas=this.canvas,r}};var rn=(t,e,r)=>{let i=new FontFace(t,"url("+e+")",{weight:r});return document.fonts.add(i),i.load()},nn=t=>new Ke(t);function Ie(t){if(t.includes("$type"))return e=>!0;if(t[0]=="==")return(e,r)=>r.props[t[1]]===t[2];if(t[0]=="!=")return(e,r)=>r.props[t[1]]!==t[2];if(t[0]=="!"){let e=Ie(t[1]);return(r,i)=>!e(r,i)}else{if(t[0]==="<")return(e,r)=>r.props[t[1]]<t[2];if(t[0]==="<=")return(e,r)=>r.props[t[1]]<=t[2];if(t[0]===">")return(e,r)=>r.props[t[1]]>t[2];if(t[0]===">=")return(e,r)=>r.props[t[1]]>=t[2];if(t[0]==="in")return(e,r)=>t.slice(2,t.length).includes(r.props[t[1]]);if(t[0]==="!in")return(e,r)=>!t.slice(2,t.length).includes(r.props[t[1]]);if(t[0]==="has")return(e,r)=>r.props.hasOwnProperty(t[1]);if(t[0]==="!has")return(e,r)=>!r.props.hasOwnProperty(t[1]);if(t[0]==="all"){let e=t.slice(1,t.length).map(r=>Ie(r));return(r,i)=>e.every(n=>n(r,i))}else if(t[0]==="any"){let e=t.slice(1,t.length).map(r=>Ie(r));return(r,i)=>e.some(n=>n(r,i))}else return console.log("Unimplemented filter: ",t[0]),e=>!1}}function et(t){if(t.base&&t.stops)return r=>V(t.base,t.stops)(r-1);if(t[0]=="interpolate"&&t[1][0]=="exponential"&&t[2]=="zoom"){let r=t.slice(3),i=[];for(var e=0;e<r.length;e+=2)i.push([r[e],r[e+1]]);return n=>V(t[1][1],i)(n-1)}else if(t[0]=="step"&&t[1][0]=="get"){let r=t.slice(2),i=t[1][1];return(n,a)=>{let s=a.props[i];if(s<r[1])return r[0];for(e=1;e<r.length;e+=2)if(s<=r[e])return r[e+1];return r[r.length-1]}}else return console.log("Unimplemented numeric fn: ",t),r=>1}function vt(t,e=0){return t?typeof t=="number"?t:et(t):e}function _t(t,e){let r=vt(t,1),i=vt(e);return(n,a)=>{let s=typeof r=="number"?r:r(n,a);return i?s+(typeof i=="number"?i:i(n,a)):s}}function Ft(t,e){let r=[];for(let o of t["text-font"])e.hasOwnProperty(o)&&r.push(e[o]);r.length===0&&r.push({face:"sans-serif"});let i=t["text-size"];var n="";r.length&&r[0].weight&&(n=r[0].weight+" ");var a="";if(r.length&&r[0].style&&(a=r[0].style+" "),typeof i=="number")return`${a}${n}${i}px ${r.map(o=>o.face).join(", ")}`;if(i.stops){var s=1.4;i.base&&(s=i.base);let o=et(i);return(l,u)=>`${a}${n}${o(l,u)}px ${r.map(h=>h.face).join(", ")}`}else if(i[0]=="step"){let o=et(i);return(l,u)=>`${a}${n}${o(l,u)}px ${r.map(h=>h.face).join(", ")}`}else return console.log("Can't parse font: ",t),o=>"12px sans-serif"}function an(t,e){let r=[],i=[],n=new Map;for(var a of t.layers){if(n.set(a.id,a),a.layout&&a.layout.visibility=="none")continue;if(a.ref){let u=n.get(a.ref);a.type=u.type,a.filter=u.filter,a.source=u.source,a["source-layer"]=u["source-layer"]}let l=a["source-layer"];var s,o=void 0;a.filter&&(o=Ie(a.filter)),a.type=="fill"?r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new D({fill:a.paint["fill-color"],opacity:a.paint["fill-opacity"]})}):a.type=="fill-extrusion"?r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new D({fill:a.paint["fill-extrusion-color"],opacity:a.paint["fill-extrusion-opacity"]})}):a.type=="line"?a.paint["line-dasharray"]?r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new A({width:_t(a.paint["line-width"],a.paint["line-gap-width"]),dash:a.paint["line-dasharray"],dashColor:a.paint["line-color"]})}):r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new A({color:a.paint["line-color"],width:_t(a.paint["line-width"],a.paint["line-gap-width"])})}):a.type=="symbol"?a.layout["symbol-placement"]=="line"?i.push({dataLayer:a["source-layer"],filter:o,symbolizer:new me({font:Ft(a.layout,e),fill:a.paint["text-color"],width:a.paint["text-halo-width"],stroke:a.paint["text-halo-color"],textTransform:a.layout["text-transform"],label_props:a.layout["text-field"]?[a.layout["text-field"]]:void 0})}):i.push({dataLayer:a["source-layer"],filter:o,symbolizer:new Z({font:Ft(a.layout,e),fill:a.paint["text-color"],stroke:a.paint["text-halo-color"],width:a.paint["text-halo-width"],textTransform:a.layout["text-transform"],label_props:a.layout["text-field"]?[a.layout["text-field"]]:void 0})}):a.type=="circle"&&r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new J({radius:a.paint["circle-radius"],fill:a.paint["circle-color"],stroke:a.paint["circle-stroke-color"],width:a.paint["circle-stroke-width"]})})}return i.reverse(),{paint_rules:r,label_rules:i,tasks:[]}}var zt=R($());var M;(function(l){l[l.N=1]="N",l[l.NE=2]="NE",l[l.E=3]="E",l[l.SE=4]="SE",l[l.S=5]="S",l[l.SW=6]="SW",l[l.W=7]="W",l[l.NW=8]="NW"})(M||(M={}));var Lt=class{constructor(e,r){this.getBbox=(e,r,i)=>({minX:e.x+r.x+i.minX,minY:e.y+r.y+i.minY,maxX:e.x+r.x+i.maxX,maxY:e.y+r.y+i.maxY});this.symbolizer=e,this.offsetX=r.offsetX||0,this.offsetY=r.offsetY||0,this.placements=r.placements||[2,6,8,4,1,5,3,7],this.attrs=r.attrs||(()=>({}))}place(e,r,i){if(i.geomType!==j.Point)return;let n=this.symbolizer.place(e,[[new zt.default(0,0)]],i);if(!n||n.length==0)return;let a=r[0][0],s=n[0],o=s.bboxes[0],l=this.offsetX,u=this.offsetY,h=this.symbolizer.justify,d=this.placements,{offsetX:m,offsetY:b,justify:x,placements:w}=this.attrs(e.zoom,i)||{};m&&(l=m),b&&(u=b),x&&(h=x),w&&(d=w);for(let f of d){let c=this.computeXAxisOffset(l,o,f),p=this.computeYAxisOffset(u,o,f),v=this.computeJustify(h,f),y=new zt.default(c,p);return this.placeLabelInPoint(a,y,e,s,v)}}placeLabelInPoint(e,r,i,n,a){let s=this.getBbox(e,r,n.bboxes[0]);if(!i.index.bboxCollides(s,i.order))return[{anchor:e,bboxes:[s],draw:this.getDrawFunction(r,n,a)}]}getDrawFunction(e,r,i){return n=>{n.translate(e.x,e.y),r.draw(n,{justify:i})}}computeXAxisOffset(e,r,i){let n=r.maxX,a=n/2;return[1,5].includes(i)?e-a:[8,7,6].includes(i)?e-n:e}computeYAxisOffset(e,r,i){let n=Math.abs(r.minY),a=r.maxY,s=(r.minY+r.maxY)/2;return[3,7].includes(i)?e-s:[8,2,1].includes(i)?e-a:[6,4,5].includes(i)?e+n:e}computeJustify(e,r){return e||([1,5].includes(r)?E.Center:[2,3,4].includes(r)?E.Left:E.Right)}},Yr=class{constructor(e){this.symbolizer=new Lt(new te(e),e)}place(e,r,i){return this.symbolizer.place(e,r,i)}};return sn;})();
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
